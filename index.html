<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µì‚¬ê´€ë¦¬ í”„ë¡œê·¸ë¨</title>
    
    <!-- ìºì‹œ ë°©ì§€ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- PWA ì„¤ì • -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <!-- ë²„ì „ ê´€ë¦¬ -->
    <meta name="version" content="2.0.0">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: white;
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }

        .container {
            width: 100%;
            height: 100vh;
            margin: 0;
            background: white;
            overflow: auto;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .header p {
            margin: 0;
            font-size: 0.9em;
            opacity: 0.9;
        }

        .firebase-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .firebase-status.connected {
            background: #4caf50;
            color: white;
        }

        .firebase-status.disconnected {
            background: #f44336;
            color: white;
        }

        .firebase-status.loading {
            background: #ff9800;
            color: white;
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            min-width: 120px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: #f5f5f5;
            border: none;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }

        .tab-content.active {
            display: block;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .form-section {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
            position: sticky;
            top: 0;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .action-btns {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 5px;
            font-size: 14px;
        }

        .low-stock {
            background: #ffebee !important;
        }

        .completed-item {
            text-decoration: line-through;
            text-decoration-color: #f44336;
            text-decoration-thickness: 2px;
            opacity: 0.7;
        }

        .checkbox-cell {
            text-align: center;
        }

        .checkbox-cell input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ì•Œë¦¼ í† ìŠ¤íŠ¸ */
        .notification-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 10000;
            display: none;
            animation: slideIn 0.3s ease-out;
            max-width: 350px;
        }

        .notification-toast.show {
            display: block;
        }

        .notification-toast.notice {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .notification-toast.team {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .notification-toast.material {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .notification-toast.incoming {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .notification-toast.outgoing {
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification-header {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .notification-body {
            font-size: 14px;
            opacity: 0.95;
        }

        /* ì•Œë¦¼ ì„¤ì • ë²„íŠ¼ */
        .notification-settings {
            position: fixed;
            top: 60px;
            right: 10px;
            z-index: 999;
        }

        .notification-toggle {
            background: white;
            border: 2px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .notification-toggle:hover {
            transform: scale(1.1);
        }

        .notification-toggle.disabled {
            background: #ccc;
            border-color: #999;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Firebase ì—°ê²° ìƒíƒœ -->
    <div class="firebase-status loading" id="firebase-status">
        <span>â—</span> ì—°ê²° ì¤‘...
    </div>

    <!-- ì•Œë¦¼ ì„¤ì • ë²„íŠ¼ -->
    <div class="notification-settings">
        <button class="notification-toggle" id="notification-toggle" onclick="toggleNotifications()" title="ì•Œë¦¼ ì„¤ì •">
            ğŸ””
        </button>
    </div>

    <!-- ì•Œë¦¼ í† ìŠ¤íŠ¸ -->
    <div class="notification-toast" id="notification-toast">
        <div class="notification-header" id="notification-header"></div>
        <div class="notification-body" id="notification-body"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸ—ï¸ ê³µì‚¬ê´€ë¦¬ í”„ë¡œê·¸ë¨ (Firebase ì‹¤ì‹œê°„ ë™ê¸°í™”)</h1>
            <p>ìì¬ ê´€ë¦¬ ë° ì—…ë¬´ í˜„í™© í†µí•© ì‹œìŠ¤í…œ <span style="font-size: 0.8em; opacity: 0.7; margin-left: 10px;">v2.0.0</span></p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
            <button class="tab" onclick="showTab('notices')">ğŸ“¢ ê³µì§€ì‚¬í•­</button>
            <button class="tab" onclick="showTab('team-status')">ğŸ‘¥ íŒ€ë³„ ì—…ë¬´í˜„í™©</button>
            <button class="tab" onclick="showTab('materials')">ğŸ“¦ ìì¬ ëª©ë¡</button>
            <button class="tab" onclick="showTab('incoming')">ğŸ“¥ ì…ê³  ê´€ë¦¬</button>
            <button class="tab" onclick="showTab('outgoing')">ğŸ“¤ ì‚¬ìš©(ì¶œê³ ) ê´€ë¦¬</button>
            <button class="tab" onclick="showTab('history')">ğŸ“‹ ì „ì²´ ë‚´ì—­</button>
        </div>

        <!-- ëŒ€ì‹œë³´ë“œ íƒ­ -->
        <div id="dashboard" class="tab-content active">
            <div class="alert" id="dashboard-alert"></div>
            
            <div class="stats-container">
                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <h3>ğŸ“¢ ê³µì§€ì‚¬í•­ (ìµœê·¼ 5ê°œ)</h3>
                    <div id="notice-list" style="margin-top: 15px; max-height: 200px; overflow-y: auto;">
                        <p style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                    <button onclick="showTab('notices'); event.stopPropagation();" class="btn btn-primary" style="margin-top: 10px; width: 100%; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);">ê³µì§€ì‚¬í•­ ê´€ë¦¬</button>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <h3>ğŸ‘¥ íŒ€ë³„ ì—…ë¬´í˜„í™© (ìµœê·¼ 5ê°œ)</h3>
                    <div id="team-status-list" style="margin-top: 15px; max-height: 200px; overflow-y: auto;">
                        <p style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">ë“±ë¡ëœ ì—…ë¬´í˜„í™©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                    <button onclick="showTab('team-status'); event.stopPropagation();" class="btn btn-primary" style="margin-top: 10px; width: 100%; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);">ì—…ë¬´í˜„í™© ê´€ë¦¬</button>
                </div>
            </div>

            <h2 style="margin-bottom: 15px;">ğŸ“‹ ìì¬ í˜„í™©</h2>
            <div class="table-container">
                <table id="low-stock-table">
                    <thead>
                        <tr>
                            <th>ë²ˆí˜¸</th>
                            <th>í’ˆëª…</th>
                            <th>ê·œê²©</th>
                            <th>ë‹¨ìœ„</th>
                            <th>ê³„ì•½ìˆ˜ëŸ‰</th>
                            <th>ì…ê³ ìˆ˜ëŸ‰</th>
                            <th>ì‚¬ìš©ìˆ˜ëŸ‰</th>
                            <th>ì”ì—¬ìˆ˜ëŸ‰</th>
                            <th>ë¶€ì¡±ë¥ </th>
                            <th>ë¹„ê³ </th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- ê³µì§€ì‚¬í•­ íƒ­ -->
        <div id="notices" class="tab-content">
            <div class="alert" id="notices-alert"></div>
            
            <div class="form-section">
                <h2 style="margin-bottom: 15px;">ğŸ“¢ ê³µì§€ì‚¬í•­ ë“±ë¡</h2>
                <form id="notice-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>ì œëª© *</label>
                            <input type="text" id="notice-title" required>
                        </div>
                        <div class="form-group">
                            <label>ì‘ì„±ì¼ *</label>
                            <input type="date" id="notice-date" required>
                        </div>
                        <div class="form-group">
                            <label>ì™„ë£Œê¸°í•œ</label>
                            <input type="date" id="notice-deadline">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ë‚´ìš© *</label>
                            <textarea id="notice-content" required style="min-height: 100px;"></textarea>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">ê³µì§€ì‚¬í•­ ë“±ë¡</button>
                        <button type="button" class="btn btn-warning" onclick="resetNoticeForm()">ì´ˆê¸°í™”</button>
                    </div>
                </form>
            </div>

            <div class="search-box">
                <input type="text" id="notice-search" placeholder="ğŸ” ì œëª©, ë‚´ìš©ìœ¼ë¡œ ê²€ìƒ‰..." onkeyup="searchNotices()">
            </div>

            <div class="table-container">
                <table id="notices-table">
                    <thead>
                        <tr>
                            <th>ë²ˆí˜¸</th>
                            <th>ì™„ë£Œ</th>
                            <th>ì œëª©</th>
                            <th>ë‚´ìš©</th>
                            <th>ì‘ì„±ì¼</th>
                            <th>ì™„ë£Œê¸°í•œ</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- íŒ€ë³„ ì—…ë¬´í˜„í™© íƒ­ -->
        <div id="team-status" class="tab-content">
            <div class="alert" id="team-status-alert"></div>
            
            <div class="form-section">
                <h2 style="margin-bottom: 15px;">ğŸ‘¥ íŒ€ë³„ ì—…ë¬´í˜„í™© ë“±ë¡</h2>
                <form id="team-status-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>íŒ€ëª… *</label>
                            <input type="text" id="team-name" required>
                        </div>
                        <div class="form-group">
                            <label>ì‘ì„±ì¼ *</label>
                            <input type="date" id="team-date" required>
                        </div>
                        <div class="form-group">
                            <label>ì™„ë£Œê¸°í•œ</label>
                            <input type="date" id="team-deadline">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ì—…ë¬´ë‚´ìš© *</label>
                            <textarea id="team-content" required style="min-height: 100px;"></textarea>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">ì—…ë¬´í˜„í™© ë“±ë¡</button>
                        <button type="button" class="btn btn-warning" onclick="resetTeamStatusForm()">ì´ˆê¸°í™”</button>
                    </div>
                </form>
            </div>

            <div class="search-box">
                <input type="text" id="team-status-search" placeholder="ğŸ” íŒ€ëª…, ì—…ë¬´ë‚´ìš©ìœ¼ë¡œ ê²€ìƒ‰..." onkeyup="searchTeamStatus()">
            </div>

            <div class="table-container">
                <table id="team-status-table">
                    <thead>
                        <tr>
                            <th>ë²ˆí˜¸</th>
                            <th>ì™„ë£Œ</th>
                            <th>íŒ€ëª…</th>
                            <th>ì—…ë¬´ë‚´ìš©</th>
                            <th>ì‘ì„±ì¼</th>
                            <th>ì™„ë£Œê¸°í•œ</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- ìì¬ ëª©ë¡ íƒ­ -->
        <div id="materials" class="tab-content">
            <div class="alert" id="materials-alert"></div>
            
            <div class="form-section">
                <h2 style="margin-bottom: 15px;">â• ìì¬ ë“±ë¡</h2>
                
                <div style="margin-bottom: 20px; padding: 15px; background: #e3f2fd; border-radius: 5px;">
                    <h3 style="margin-bottom: 10px;">ğŸ“ ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ (ìë™ ë“±ë¡)</h3>
                    <p style="font-size: 13px; color: #666; margin-bottom: 10px;">ì—‘ì…€ íŒŒì¼ í˜•ì‹: í’ˆëª…, ê·œê²©, ë‹¨ìœ„, ê³„ì•½ìˆ˜ëŸ‰, ë¹„ê³  (ì²« ë²ˆì§¸ í–‰ì€ í—¤ë”)</p>
                    <p style="font-size: 13px; color: #d32f2f; margin-bottom: 10px;">â€» ì—…ë¡œë“œ ì‹œ ì¤‘ë³µë˜ì§€ ì•Šì€ ìì¬ê°€ ìë™ìœ¼ë¡œ ë“±ë¡ë©ë‹ˆë‹¤.</p>
                    <input type="file" id="excel-upload" accept=".xlsx,.xlsm,.xlsb,.xls,.csv" style="padding: 10px; border: 2px solid #2196F3; border-radius: 5px; background: white;">
                    <button type="button" class="btn btn-info" onclick="uploadExcel()" style="margin-left: 10px;">ì—…ë¡œë“œ ë° ìë™ ë“±ë¡</button>
                </div>
                
                <form id="material-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>í’ˆëª… *</label>
                            <select id="mat-name" required onchange="onMaterialNameChange()">
                                <option value="">í’ˆëª…ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ê·œê²© *</label>
                            <select id="mat-spec" required>
                                <option value="">ê·œê²©ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ë‹¨ìœ„ *</label>
                            <input type="text" id="mat-unit" required list="material-unit-list">
                            <datalist id="material-unit-list"></datalist>
                        </div>
                        <div class="form-group">
                            <label>ê³„ì•½ìˆ˜ëŸ‰ *</label>
                            <input type="number" id="mat-quantity" required min="0" step="0.01">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ë¹„ê³ </label>
                            <textarea id="mat-note"></textarea>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">ìì¬ ë“±ë¡</button>
                        <button type="button" class="btn btn-warning" onclick="resetMaterialForm()">ì´ˆê¸°í™”</button>
                    </div>
                </form>
            </div>

            <div class="search-box">
                <input type="text" id="material-search" placeholder="ğŸ” ìì¬ëª…, ê·œê²©ìœ¼ë¡œ ê²€ìƒ‰..." onkeyup="searchMaterials()">
            </div>

            <div class="btn-group">
                <button class="btn btn-success" onclick="exportToExcel('materials')">ğŸ“¥ Excel ë‹¤ìš´ë¡œë“œ</button>
                <button class="btn btn-info" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„</button>
            </div>

            <div class="table-container">
                <table id="materials-table">
                    <thead>
                        <tr>
                            <th>ë²ˆí˜¸</th>
                            <th>í’ˆëª…</th>
                            <th>ê·œê²©</th>
                            <th>ë‹¨ìœ„</th>
                            <th>ê³„ì•½ìˆ˜ëŸ‰</th>
                            <th>ì…ê³ ìˆ˜ëŸ‰</th>
                            <th>ì‚¬ìš©ìˆ˜ëŸ‰</th>
                            <th>ì”ì—¬ìˆ˜ëŸ‰</th>
                            <th>ë¹„ê³ </th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- ì…ê³  ê´€ë¦¬ íƒ­ -->
        <div id="incoming" class="tab-content">
            <div class="alert" id="incoming-alert"></div>
            
            <div class="form-section">
                <h2 style="margin-bottom: 15px;">ğŸ“¥ ì…ê³  ë“±ë¡</h2>
                <form id="incoming-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>í’ˆëª… *</label>
                            <select id="in-material-name" required onchange="onIncomingNameChange()">
                                <option value="">í’ˆëª…ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ê·œê²© *</label>
                            <select id="in-material-spec" required onchange="onIncomingSpecChange()">
                                <option value="">ê·œê²©ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ì…ê³ ì¼ *</label>
                            <input type="date" id="in-date" required>
                        </div>
                        <div class="form-group">
                            <label>ì…ê³ ìˆ˜ëŸ‰ *</label>
                            <input type="number" id="in-quantity" required min="0.01" step="0.01">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ë¹„ê³ </label>
                            <textarea id="in-note"></textarea>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">ì…ê³  ë“±ë¡</button>
                        <button type="button" class="btn btn-warning" onclick="resetIncomingForm()">ì´ˆê¸°í™”</button>
                    </div>
                </form>
            </div>

            <div class="search-box">
                <input type="text" id="incoming-search" placeholder="ğŸ” ìì¬ëª…ìœ¼ë¡œ ê²€ìƒ‰..." onkeyup="searchIncoming()">
            </div>

            <div class="btn-group">
                <button class="btn btn-success" onclick="exportToExcel('incoming')">ğŸ“¥ Excel ë‹¤ìš´ë¡œë“œ</button>
            </div>

            <div class="table-container">
                <table id="incoming-table">
                    <thead>
                        <tr>
                            <th>ë²ˆí˜¸</th>
                            <th>í’ˆëª…</th>
                            <th>ê·œê²©</th>
                            <th>ë‹¨ìœ„</th>
                            <th>ì…ê³ ì¼</th>
                            <th>ì…ê³ ìˆ˜ëŸ‰</th>
                            <th>ë¹„ê³ </th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- ì‚¬ìš©(ì¶œê³ ) ê´€ë¦¬ íƒ­ -->
        <div id="outgoing" class="tab-content">
            <div class="alert" id="outgoing-alert"></div>
            
            <div class="form-section">
                <h2 style="margin-bottom: 15px;">ğŸ“¤ ì‚¬ìš©(ì¶œê³ ) ë“±ë¡</h2>
                <form id="outgoing-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>í’ˆëª… *</label>
                            <select id="out-material-name" required onchange="onOutgoingNameChange()">
                                <option value="">í’ˆëª…ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ê·œê²© *</label>
                            <select id="out-material-spec" required onchange="onOutgoingSpecChange()">
                                <option value="">ê·œê²©ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ì‚¬ìš©ì¼ *</label>
                            <input type="date" id="out-date" required>
                        </div>
                        <div class="form-group">
                            <label>ì‚¬ìš©ìˆ˜ëŸ‰ *</label>
                            <input type="number" id="out-quantity" required min="0.01" step="0.01">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ë¹„ê³ </label>
                            <textarea id="out-note"></textarea>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">ì‚¬ìš© ë“±ë¡</button>
                        <button type="button" class="btn btn-warning" onclick="resetOutgoingForm()">ì´ˆê¸°í™”</button>
                    </div>
                </form>
            </div>

            <div class="search-box">
                <input type="text" id="outgoing-search" placeholder="ğŸ” ìì¬ëª…ìœ¼ë¡œ ê²€ìƒ‰..." onkeyup="searchOutgoing()">
            </div>

            <div class="btn-group">
                <button class="btn btn-success" onclick="exportToExcel('outgoing')">ğŸ“¥ Excel ë‹¤ìš´ë¡œë“œ</button>
            </div>

            <div class="table-container">
                <table id="outgoing-table">
                    <thead>
                        <tr>
                            <th>ë²ˆí˜¸</th>
                            <th>í’ˆëª…</th>
                            <th>ê·œê²©</th>
                            <th>ë‹¨ìœ„</th>
                            <th>ì‚¬ìš©ì¼</th>
                            <th>ì‚¬ìš©ìˆ˜ëŸ‰</th>
                            <th>ë¹„ê³ </th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- ì „ì²´ ë‚´ì—­ íƒ­ -->
        <div id="history" class="tab-content">
            <div class="alert" id="history-alert"></div>
            
            <div class="search-box">
                <input type="text" id="history-search" placeholder="ğŸ” ìì¬ëª…ìœ¼ë¡œ ê²€ìƒ‰..." onkeyup="searchHistory()">
            </div>

            <div class="btn-group">
                <button class="btn btn-success" onclick="exportToExcel('history')">ğŸ“¥ Excel ë‹¤ìš´ë¡œë“œ</button>
            </div>

            <div class="table-container">
                <table id="history-table">
                    <thead>
                        <tr>
                            <th>ë²ˆí˜¸</th>
                            <th>í’ˆëª…</th>
                            <th>ê·œê²©</th>
                            <th>ë‹¨ìœ„</th>
                            <th>ê³„ì•½ìˆ˜ëŸ‰</th>
                            <th>ì…ê³ ì¼</th>
                            <th>ì…ê³ ìˆ˜ëŸ‰</th>
                            <th>ì‚¬ìš©ì¼</th>
                            <th>ì‚¬ìš©ìˆ˜ëŸ‰</th>
                            <th>ì”ì—¬ìˆ˜ëŸ‰</th>
                            <th>ë¹„ê³ </th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- SheetJS ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        // ========================================
        // ğŸ”¥ Firebase ì„¤ì •
        // ========================================
        const firebaseConfig = {
            apiKey: "AIzaSyBQrZ3fxpjXAXT8i991iUReu-YnMYGN8jU",
            authDomain: "sy1bl-31462.firebaseapp.com",
            databaseURL: "https://sy1bl-31462-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "sy1bl-31462",
            storageBucket: "sy1bl-31462.firebasestorage.app",
            messagingSenderId: "823520271852",
            appId: "1:823520271852:web:21b1d3239d6916f79174c9",
            measurementId: "G-8CXK5921NF"
        };

        // Firebase ì´ˆê¸°í™”
        let database;
        let isFirebaseConnected = false;

        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            
            // ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§
            const connectedRef = database.ref('.info/connected');
            connectedRef.on('value', (snapshot) => {
                if (snapshot.val() === true) {
                    updateFirebaseStatus('connected');
                    isFirebaseConnected = true;
                } else {
                    updateFirebaseStatus('disconnected');
                    isFirebaseConnected = false;
                }
            });
            
        } catch (error) {
            console.error('Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
            updateFirebaseStatus('disconnected');
            alert('Firebase ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”. firebaseConfig ì •ë³´ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì…¨ë‚˜ìš”?');
        }

        // Firebase ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateFirebaseStatus(status) {
            const statusEl = document.getElementById('firebase-status');
            statusEl.className = `firebase-status ${status}`;
            
            if (status === 'connected') {
                statusEl.innerHTML = '<span>â—</span> ì—°ê²°ë¨';
            } else if (status === 'disconnected') {
                statusEl.innerHTML = '<span>â—</span> ì—°ê²° ëŠê¹€';
            } else {
                statusEl.innerHTML = '<span>â—</span> ì—°ê²° ì¤‘...';
            }
        }

        // ë°ì´í„° ì €ì¥ì†Œ (Firebase ë™ê¸°í™”)
        let notices = [];
        let teamStatuses = [];
        let materials = [];
        let incoming = [];
        let outgoing = [];
        let uploadedMaterials = [];

        // ì‚­ì œ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • (ì›í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¡œ ë³€ê²½ ê°€ëŠ¥)
        const DELETE_PASSWORD = '1111'; // ì‚­ì œ ë¹„ë°€ë²ˆí˜¸

        // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ í•¨ìˆ˜
        function checkDeletePassword() {
            const inputPassword = prompt('ì‚­ì œí•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            
            if (inputPassword === null) {
                // ì·¨ì†Œ ë²„íŠ¼ í´ë¦­
                return false;
            }
            
            if (inputPassword === DELETE_PASSWORD) {
                return true;
            } else {
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤. ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return false;
            }
        }

        // ì•Œë¦¼ ì„¤ì •
        let notificationsEnabled = localStorage.getItem('notificationsEnabled') !== 'false';
        let isFirstLoad = true; // ì´ˆê¸° ë¡œë“œ ì‹œ ì•Œë¦¼ ë°©ì§€
        let previousDataCount = {
            notices: 0,
            teamStatuses: 0,
            materials: 0,
            incoming: 0,
            outgoing: 0
        };

        // ì•Œë¦¼ ì†Œë¦¬ ìƒì„± (Web Audio API)
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let notificationTimeouts = []; // ì•Œë¦¼ íƒ€ì„ì•„ì›ƒ ì €ì¥
        
        function playNotificationSound() {
            if (!notificationsEnabled) return;
            
            // ê¸°ì¡´ íƒ€ì„ì•„ì›ƒ ëª¨ë‘ ì œê±°
            stopNotificationSound();
            
            // 10íšŒ ë°˜ë³µ ì•Œë¦¼ìŒ
            for (let i = 0; i < 10; i++) {
                const timeout = setTimeout(() => {
                    // ì²« ë²ˆì§¸ ìŒ
                    const oscillator1 = audioContext.createOscillator();
                    const gainNode1 = audioContext.createGain();
                    
                    oscillator1.connect(gainNode1);
                    gainNode1.connect(audioContext.destination);
                    
                    oscillator1.frequency.value = 880;
                    oscillator1.type = 'sine';
                    
                    // ìµœëŒ€ ë³¼ë¥¨ (1.0)
                    gainNode1.gain.setValueAtTime(1.0, audioContext.currentTime);
                    gainNode1.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    
                    oscillator1.start(audioContext.currentTime);
                    oscillator1.stop(audioContext.currentTime + 0.3);
                    
                    // ë‘ ë²ˆì§¸ ìŒ (ì•½ê°„ ë†’ì€ ìŒ)
                    setTimeout(() => {
                        const oscillator2 = audioContext.createOscillator();
                        const gainNode2 = audioContext.createGain();
                        
                        oscillator2.connect(gainNode2);
                        gainNode2.connect(audioContext.destination);
                        
                        oscillator2.frequency.value = 1100;
                        oscillator2.type = 'sine';
                        
                        // ìµœëŒ€ ë³¼ë¥¨ (1.0)
                        gainNode2.gain.setValueAtTime(1.0, audioContext.currentTime);
                        gainNode2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                        
                        oscillator2.start(audioContext.currentTime);
                        oscillator2.stop(audioContext.currentTime + 0.3);
                    }, 150);
                    
                }, i * 700); // 0.7ì´ˆ ê°„ê²©ìœ¼ë¡œ 10íšŒ ë°˜ë³µ
                
                notificationTimeouts.push(timeout);
            }
        }
        
        // ì•Œë¦¼ ì†Œë¦¬ ì¤‘ì§€
        function stopNotificationSound() {
            notificationTimeouts.forEach(timeout => clearTimeout(timeout));
            notificationTimeouts = [];
        }

        // ì§„ë™ (ëª¨ë°”ì¼) - ê°•í™”
        function vibrate() {
            if (!notificationsEnabled) return;
            
            if (navigator.vibrate) {
                // ë” ê¸´ ì§„ë™ íŒ¨í„´ (ì´ 3ì´ˆ, ë°˜ë³µ)
                navigator.vibrate([500, 200, 500, 200, 500, 200, 500]);
            }
        }

        // ì•Œë¦¼ í† ìŠ¤íŠ¸ í‘œì‹œ - ìˆ˜ë™ìœ¼ë¡œ ë‹«ì„ ë•Œê¹Œì§€ ìœ ì§€
        function showNotificationToast(type, title, message) {
            if (!notificationsEnabled || isFirstLoad) return;
            
            const toast = document.getElementById('notification-toast');
            const header = document.getElementById('notification-header');
            const body = document.getElementById('notification-body');
            
            // ê¸°ì¡´ í´ë˜ìŠ¤ ì œê±°
            toast.className = 'notification-toast';
            
            // íƒ€ì…ë³„ í´ë˜ìŠ¤ ì¶”ê°€
            toast.classList.add(type);
            toast.classList.add('show');
            
            header.innerHTML = `${title} <span style="float: right; cursor: pointer; font-size: 20px;" onclick="closeNotification()">âœ–</span>`;
            body.textContent = message;
            
            // ì†Œë¦¬ì™€ ì§„ë™
            playNotificationSound();
            vibrate();
            
            // ìë™ìœ¼ë¡œ ì‚¬ë¼ì§€ì§€ ì•ŠìŒ - ìˆ˜ë™ìœ¼ë¡œ ë‹«ì•„ì•¼ í•¨
            // setTimeout ì œê±°
        }

        // ì•Œë¦¼ ìˆ˜ë™ìœ¼ë¡œ ë‹«ê¸° (ì†Œë¦¬ë„ í•¨ê»˜ ì¤‘ì§€)
        function closeNotification() {
            const toast = document.getElementById('notification-toast');
            toast.classList.remove('show');
            
            // ì•Œë¦¼ ì†Œë¦¬ ì¤‘ì§€
            stopNotificationSound();
        }

        // ì•Œë¦¼ í† ê¸€
        function toggleNotifications() {
            notificationsEnabled = !notificationsEnabled;
            localStorage.setItem('notificationsEnabled', notificationsEnabled);
            
            const toggleBtn = document.getElementById('notification-toggle');
            
            if (notificationsEnabled) {
                toggleBtn.textContent = 'ğŸ””';
                toggleBtn.classList.remove('disabled');
                toggleBtn.title = 'ì•Œë¦¼ ì¼œì§ (í´ë¦­í•˜ì—¬ ë„ê¸°)';
                showAlert('dashboard-alert', 'ì•Œë¦¼ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } else {
                toggleBtn.textContent = 'ğŸ”•';
                toggleBtn.classList.add('disabled');
                toggleBtn.title = 'ì•Œë¦¼ êº¼ì§ (í´ë¦­í•˜ì—¬ ì¼œê¸°)';
                showAlert('dashboard-alert', 'ì•Œë¦¼ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'warning');
            }
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            setTodayDate();
            setupFirebaseListeners();
            loadAllData();
            
            // ì•Œë¦¼ ë²„íŠ¼ ì´ˆê¸° ìƒíƒœ ì„¤ì •
            const toggleBtn = document.getElementById('notification-toggle');
            if (!notificationsEnabled) {
                toggleBtn.textContent = 'ğŸ”•';
                toggleBtn.classList.add('disabled');
                toggleBtn.title = 'ì•Œë¦¼ êº¼ì§ (í´ë¦­í•˜ì—¬ ì¼œê¸°)';
            } else {
                toggleBtn.title = 'ì•Œë¦¼ ì¼œì§ (í´ë¦­í•˜ì—¬ ë„ê¸°)';
            }
            
            // 3ì´ˆ í›„ ì²« ë¡œë“œ ì™„ë£Œë¡œ ì„¤ì • (ì´í›„ë¶€í„° ì•Œë¦¼ í™œì„±í™”)
            setTimeout(() => {
                isFirstLoad = false;
            }, 3000);
        });

        // Firebase ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupFirebaseListeners() {
            // ê³µì§€ì‚¬í•­ ì‹¤ì‹œê°„ ë™ê¸°í™”
            database.ref('notices').on('value', (snapshot) => {
                const data = snapshot.val();
                const newNotices = data ? Object.values(data) : [];
                
                // ìƒˆ ë°ì´í„° ê°ì§€
                if (!isFirstLoad && newNotices.length > previousDataCount.notices) {
                    const newItem = newNotices[newNotices.length - 1];
                    showNotificationToast('notice', 'ğŸ“¢ ìƒˆ ê³µì§€ì‚¬í•­', newItem.title);
                }
                
                previousDataCount.notices = newNotices.length;
                notices = newNotices;
                loadNotices();
                loadDashboardNotices();
            });

            // íŒ€ë³„ ì—…ë¬´í˜„í™© ì‹¤ì‹œê°„ ë™ê¸°í™”
            database.ref('teamStatuses').on('value', (snapshot) => {
                const data = snapshot.val();
                const newStatuses = data ? Object.values(data) : [];
                
                // ìƒˆ ë°ì´í„° ê°ì§€
                if (!isFirstLoad && newStatuses.length > previousDataCount.teamStatuses) {
                    const newItem = newStatuses[newStatuses.length - 1];
                    showNotificationToast('team', 'ğŸ‘¥ ìƒˆ ì—…ë¬´í˜„í™©', `${newItem.teamName}: ${newItem.content.substring(0, 30)}...`);
                }
                
                previousDataCount.teamStatuses = newStatuses.length;
                teamStatuses = newStatuses;
                loadTeamStatuses();
                loadDashboardTeamStatuses();
            });

            // ìì¬ ëª©ë¡ ì‹¤ì‹œê°„ ë™ê¸°í™”
            database.ref('materials').on('value', (snapshot) => {
                const data = snapshot.val();
                const newMaterials = data ? Object.values(data) : [];
                
                // ìƒˆ ë°ì´í„° ê°ì§€
                if (!isFirstLoad && newMaterials.length > previousDataCount.materials) {
                    const newItem = newMaterials[newMaterials.length - 1];
                    showNotificationToast('material', 'ğŸ“¦ ìƒˆ ìì¬ ë“±ë¡', `${newItem.name} (${newItem.spec})`);
                }
                
                previousDataCount.materials = newMaterials.length;
                materials = newMaterials;
                loadMaterials();
                updateDashboard();
                updateMaterialSelects();
                updateOutgoingMaterialSelects();
            });

            // ì…ê³  ë‚´ì—­ ì‹¤ì‹œê°„ ë™ê¸°í™”
            database.ref('incoming').on('value', (snapshot) => {
                const data = snapshot.val();
                const newIncoming = data ? Object.values(data) : [];
                
                // ìƒˆ ë°ì´í„° ê°ì§€
                if (!isFirstLoad && newIncoming.length > previousDataCount.incoming) {
                    const newItem = newIncoming[newIncoming.length - 1];
                    const material = materials.find(m => m.id === newItem.materialId);
                    if (material) {
                        showNotificationToast('incoming', 'ğŸ“¥ ìƒˆ ì…ê³ ', `${material.name} ${newItem.quantity}${material.unit}`);
                    }
                }
                
                previousDataCount.incoming = newIncoming.length;
                incoming = newIncoming;
                loadIncoming();
                updateDashboard();
                updateOutgoingMaterialSelects();
            });

            // ì¶œê³  ë‚´ì—­ ì‹¤ì‹œê°„ ë™ê¸°í™”
            database.ref('outgoing').on('value', (snapshot) => {
                const data = snapshot.val();
                const newOutgoing = data ? Object.values(data) : [];
                
                // ìƒˆ ë°ì´í„° ê°ì§€
                if (!isFirstLoad && newOutgoing.length > previousDataCount.outgoing) {
                    const newItem = newOutgoing[newOutgoing.length - 1];
                    const material = materials.find(m => m.id === newItem.materialId);
                    if (material) {
                        showNotificationToast('outgoing', 'ğŸ“¤ ìƒˆ ì‚¬ìš©(ì¶œê³ )', `${material.name} ${newItem.quantity}${material.unit}`);
                    }
                }
                
                previousDataCount.outgoing = newOutgoing.length;
                outgoing = newOutgoing;
                loadOutgoing();
                updateDashboard();
            });
        }

        // ë‚ ì§œ ì´ˆê¸°í™”
        function setTodayDate() {
            const today = new Date().toISOString().split('T')[0];
            if (document.getElementById('notice-date')) {
                document.getElementById('notice-date').value = today;
            }
            if (document.getElementById('team-date')) {
                document.getElementById('team-date').value = today;
            }
            if (document.getElementById('in-date')) {
                document.getElementById('in-date').value = today;
            }
            if (document.getElementById('out-date')) {
                document.getElementById('out-date').value = today;
            }
        }

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            const clickedTab = Array.from(tabs).find(tab => 
                tab.getAttribute('onclick') && tab.getAttribute('onclick').includes(tabName)
            );
            if (clickedTab) clickedTab.classList.add('active');
            
            document.getElementById(tabName).classList.add('active');
        }

        // ê³µì§€ì‚¬í•­ ë“±ë¡
        document.getElementById('notice-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const notice = {
                id: Date.now(),
                title: document.getElementById('notice-title').value,
                content: document.getElementById('notice-content').value,
                date: document.getElementById('notice-date').value,
                deadline: document.getElementById('notice-deadline').value || '',
                completed: false
            };
            
            // Firebaseì— ì €ì¥
            database.ref('notices/' + notice.id).set(notice)
                .then(() => {
                    showAlert('notices-alert', 'ê³µì§€ì‚¬í•­ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    resetNoticeForm();
                })
                .catch((error) => {
                    showAlert('notices-alert', 'ë“±ë¡ ì‹¤íŒ¨: ' + error.message, 'error');
                });
        });

        // íŒ€ë³„ ì—…ë¬´í˜„í™© ë“±ë¡
        document.getElementById('team-status-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const teamStatus = {
                id: Date.now(),
                teamName: document.getElementById('team-name').value,
                content: document.getElementById('team-content').value,
                date: document.getElementById('team-date').value,
                deadline: document.getElementById('team-deadline').value || '',
                completed: false
            };
            
            // Firebaseì— ì €ì¥
            database.ref('teamStatuses/' + teamStatus.id).set(teamStatus)
                .then(() => {
                    showAlert('team-status-alert', 'íŒ€ë³„ ì—…ë¬´í˜„í™©ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    resetTeamStatusForm();
                })
                .catch((error) => {
                    showAlert('team-status-alert', 'ë“±ë¡ ì‹¤íŒ¨: ' + error.message, 'error');
                });
        });

        // ê³µì§€ì‚¬í•­ ëª©ë¡ ë¡œë“œ
        function loadNotices() {
            const tbody = document.getElementById('notices-table').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            
            const sortedNotices = [...notices].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedNotices.forEach((notice, index) => {
                const row = tbody.insertRow();
                const completedClass = notice.completed ? 'completed-item' : '';
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td class="checkbox-cell">
                        <input type="checkbox" ${notice.completed ? 'checked' : ''} 
                               onchange="toggleNoticeComplete(${notice.id})">
                    </td>
                    <td class="${completedClass}">${notice.title}</td>
                    <td class="${completedClass}" style="max-width: 300px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${notice.content}</td>
                    <td class="${completedClass}">${notice.date}</td>
                    <td class="${completedClass}">${notice.deadline || '-'}</td>
                    <td class="action-btns">
                        <button class="action-btn btn-danger" onclick="deleteNotice(${notice.id})">ì‚­ì œ</button>
                    </td>
                `;
            });
            
            if (notices.length === 0) {
                const row = tbody.insertRow();
                row.innerHTML = '<td colspan="7" style="text-align: center; padding: 30px;">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</td>';
            }
        }

        // íŒ€ë³„ ì—…ë¬´í˜„í™© ëª©ë¡ ë¡œë“œ
        function loadTeamStatuses() {
            const tbody = document.getElementById('team-status-table').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            
            const sortedStatuses = [...teamStatuses].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedStatuses.forEach((status, index) => {
                const row = tbody.insertRow();
                const completedClass = status.completed ? 'completed-item' : '';
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td class="checkbox-cell">
                        <input type="checkbox" ${status.completed ? 'checked' : ''} 
                               onchange="toggleTeamStatusComplete(${status.id})">
                    </td>
                    <td class="${completedClass}">${status.teamName}</td>
                    <td class="${completedClass}" style="max-width: 300px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${status.content}</td>
                    <td class="${completedClass}">${status.date}</td>
                    <td class="${completedClass}">${status.deadline || '-'}</td>
                    <td class="action-btns">
                        <button class="action-btn btn-danger" onclick="deleteTeamStatus(${status.id})">ì‚­ì œ</button>
                    </td>
                `;
            });
            
            if (teamStatuses.length === 0) {
                const row = tbody.insertRow();
                row.innerHTML = '<td colspan="7" style="text-align: center; padding: 30px;">ë“±ë¡ëœ ì—…ë¬´í˜„í™©ì´ ì—†ìŠµë‹ˆë‹¤.</td>';
            }
        }

        // ëŒ€ì‹œë³´ë“œì— ê³µì§€ì‚¬í•­ í‘œì‹œ
        function loadDashboardNotices() {
            const noticeList = document.getElementById('notice-list');
            const sortedNotices = [...notices].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);
            
            if (sortedNotices.length === 0) {
                noticeList.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
                noticeList.innerHTML = sortedNotices.map(notice => {
                    const completedStyle = notice.completed ? 'text-decoration: line-through; text-decoration-color: #ff0000; opacity: 0.7;' : '';
                    const deadlineText = notice.deadline ? `<div style="font-size: 11px; opacity: 0.7;">ê¸°í•œ: ${notice.deadline}</div>` : '';
                    
                    return `
                    <div style="background: rgba(255,255,255,0.2); padding: 10px; margin-bottom: 8px; border-radius: 5px; border-left: 3px solid white;">
                        <div style="font-weight: bold; margin-bottom: 5px; ${completedStyle}">${notice.completed ? 'âœ… ' : ''}${notice.title}</div>
                        <div style="font-size: 12px; opacity: 0.9; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; ${completedStyle}">${notice.content}</div>
                        <div style="font-size: 11px; opacity: 0.7;">ì‘ì„±: ${notice.date}</div>
                        ${deadlineText}
                    </div>
                `;
                }).join('');
            }
        }

        // ëŒ€ì‹œë³´ë“œì— íŒ€ë³„ ì—…ë¬´í˜„í™© í‘œì‹œ
        function loadDashboardTeamStatuses() {
            const teamStatusList = document.getElementById('team-status-list');
            const sortedStatuses = [...teamStatuses].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);
            
            if (sortedStatuses.length === 0) {
                teamStatusList.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">ë“±ë¡ëœ ì—…ë¬´í˜„í™©ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
                teamStatusList.innerHTML = sortedStatuses.map(status => {
                    const completedStyle = status.completed ? 'text-decoration: line-through; text-decoration-color: #ff0000; opacity: 0.7;' : '';
                    const deadlineText = status.deadline ? `<div style="font-size: 11px; opacity: 0.7;">ê¸°í•œ: ${status.deadline}</div>` : '';
                    
                    return `
                    <div style="background: rgba(255,255,255,0.2); padding: 10px; margin-bottom: 8px; border-radius: 5px; border-left: 3px solid white;">
                        <div style="font-weight: bold; margin-bottom: 5px; ${completedStyle}">${status.completed ? 'âœ… ' : ''}${status.teamName}</div>
                        <div style="font-size: 12px; opacity: 0.9; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; ${completedStyle}">${status.content}</div>
                        <div style="font-size: 11px; opacity: 0.7;">ì‘ì„±: ${status.date}</div>
                        ${deadlineText}
                    </div>
                `;
                }).join('');
            }
        }

        // ê³µì§€ì‚¬í•­ ì™„ë£Œ í† ê¸€
        function toggleNoticeComplete(id) {
            const notice = notices.find(n => n.id === id);
            if (notice) {
                database.ref('notices/' + id).update({
                    completed: !notice.completed
                });
            }
        }

        // íŒ€ë³„ ì—…ë¬´í˜„í™© ì™„ë£Œ í† ê¸€
        function toggleTeamStatusComplete(id) {
            const status = teamStatuses.find(t => t.id === id);
            if (status) {
                database.ref('teamStatuses/' + id).update({
                    completed: !status.completed
                });
            }
        }

        // ê³µì§€ì‚¬í•­ ì‚­ì œ
        function deleteNotice(id) {
            // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
            if (!checkDeletePassword()) {
                return;
            }
            
            if (!confirm('ì´ ê³µì§€ì‚¬í•­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            database.ref('notices/' + id).remove()
                .then(() => {
                    showAlert('notices-alert', 'ê³µì§€ì‚¬í•­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                })
                .catch((error) => {
                    showAlert('notices-alert', 'ì‚­ì œ ì‹¤íŒ¨: ' + error.message, 'error');
                });
        }

        // íŒ€ë³„ ì—…ë¬´í˜„í™© ì‚­ì œ
        function deleteTeamStatus(id) {
            // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
            if (!checkDeletePassword()) {
                return;
            }
            
            if (!confirm('ì´ ì—…ë¬´í˜„í™©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            database.ref('teamStatuses/' + id).remove()
                .then(() => {
                    showAlert('team-status-alert', 'ì—…ë¬´í˜„í™©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                })
                .catch((error) => {
                    showAlert('team-status-alert', 'ì‚­ì œ ì‹¤íŒ¨: ' + error.message, 'error');
                });
        }

        // í¼ ì´ˆê¸°í™”
        function resetNoticeForm() {
            document.getElementById('notice-form').reset();
            setTodayDate();
        }

        function resetTeamStatusForm() {
            document.getElementById('team-status-form').reset();
            setTodayDate();
        }

        // ê²€ìƒ‰ ê¸°ëŠ¥
        function searchNotices() {
            const searchText = document.getElementById('notice-search').value.toLowerCase();
            const rows = document.getElementById('notices-table').getElementsByTagName('tbody')[0].rows;
            
            Array.from(rows).forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchText) ? '' : 'none';
            });
        }

        function searchTeamStatus() {
            const searchText = document.getElementById('team-status-search').value.toLowerCase();
            const rows = document.getElementById('team-status-table').getElementsByTagName('tbody')[0].rows;
            
            Array.from(rows).forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchText) ? '' : 'none';
            });
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showAlert(elementId, message, type) {
            const alert = document.getElementById(elementId);
            alert.textContent = message;
            alert.className = `alert ${type}`;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 3000);
        }

        // ëª¨ë“  ë°ì´í„° ë¡œë“œ
        function loadAllData() {
            loadNotices();
            loadTeamStatuses();
            loadMaterials();
            loadIncoming();
            loadOutgoing();
            loadHistory();
            loadDashboardNotices();
            loadDashboardTeamStatuses();
            updateDashboard();
        }

        // ========================================
        // ìì¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
        // ========================================

        // ìì¬ ë“±ë¡
        document.getElementById('material-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const material = {
                id: Date.now(),
                name: document.getElementById('mat-name').value,
                spec: document.getElementById('mat-spec').value,
                unit: document.getElementById('mat-unit').value,
                contractQty: parseFloat(document.getElementById('mat-quantity').value),
                note: document.getElementById('mat-note').value
            };
            
            database.ref('materials/' + material.id).set(material)
                .then(() => {
                    showAlert('materials-alert', 'ìì¬ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    resetMaterialForm();
                })
                .catch((error) => {
                    showAlert('materials-alert', 'ë“±ë¡ ì‹¤íŒ¨: ' + error.message, 'error');
                });
        });

        // ì…ê³  ë“±ë¡
        document.getElementById('incoming-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const materialName = document.getElementById('in-material-name').value;
            const materialSpec = document.getElementById('in-material-spec').value;
            const material = materials.find(m => m.name === materialName && m.spec === materialSpec);
            
            if (!material) {
                showAlert('incoming-alert', 'ì„ íƒí•œ ìì¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            const record = {
                id: Date.now(),
                materialId: material.id,
                date: document.getElementById('in-date').value,
                quantity: parseFloat(document.getElementById('in-quantity').value),
                note: document.getElementById('in-note').value
            };
            
            database.ref('incoming/' + record.id).set(record)
                .then(() => {
                    showAlert('incoming-alert', 'ì…ê³ ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    resetIncomingForm();
                })
                .catch((error) => {
                    showAlert('incoming-alert', 'ë“±ë¡ ì‹¤íŒ¨: ' + error.message, 'error');
                });
        });

        // ì¶œê³  ë“±ë¡
        document.getElementById('outgoing-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const materialName = document.getElementById('out-material-name').value;
            const materialSpec = document.getElementById('out-material-spec').value;
            const material = materials.find(m => m.name === materialName && m.spec === materialSpec);
            
            if (!material) {
                showAlert('outgoing-alert', 'ì„ íƒí•œ ìì¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            const quantity = parseFloat(document.getElementById('out-quantity').value);
            
            // ì¬ê³  í™•ì¸
            const available = getAvailableQuantity(material.id);
            if (quantity > available) {
                showAlert('outgoing-alert', `ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. í˜„ì¬ ì”ì—¬ ìˆ˜ëŸ‰: ${available}`, 'error');
                return;
            }
            
            const record = {
                id: Date.now(),
                materialId: material.id,
                date: document.getElementById('out-date').value,
                quantity: quantity,
                note: document.getElementById('out-note').value
            };
            
            database.ref('outgoing/' + record.id).set(record)
                .then(() => {
                    showAlert('outgoing-alert', 'ì‚¬ìš©(ì¶œê³ )ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    resetOutgoingForm();
                })
                .catch((error) => {
                    showAlert('outgoing-alert', 'ë“±ë¡ ì‹¤íŒ¨: ' + error.message, 'error');
                });
        });

        // ìì¬ ëª©ë¡ ë¡œë“œ
        function loadMaterials() {
            const tbody = document.getElementById('materials-table').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            
            materials.forEach((material, index) => {
                const incomingQty = getIncomingQuantity(material.id);
                const outgoingQty = getOutgoingQuantity(material.id);
                const remaining = incomingQty - outgoingQty;
                
                const row = tbody.insertRow();
                const isLowStock = remaining < material.contractQty * 0.2;
                if (isLowStock) row.classList.add('low-stock');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${material.name}</td>
                    <td>${material.spec}</td>
                    <td>${material.unit}</td>
                    <td>${material.contractQty.toLocaleString()}</td>
                    <td>${incomingQty.toLocaleString()}</td>
                    <td>${outgoingQty.toLocaleString()}</td>
                    <td>${remaining.toLocaleString()}</td>
                    <td>${material.note}</td>
                    <td class="action-btns">
                        <button class="action-btn btn-danger" onclick="deleteMaterial(${material.id})">ì‚­ì œ</button>
                    </td>
                `;
            });
        }

        // ì…ê³  ë‚´ì—­ ë¡œë“œ
        function loadIncoming() {
            const tbody = document.getElementById('incoming-table').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            
            incoming.forEach((record, index) => {
                const material = materials.find(m => m.id === record.materialId);
                if (!material) return;
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${material.name}</td>
                    <td>${material.spec}</td>
                    <td>${material.unit}</td>
                    <td>${record.date}</td>
                    <td>${record.quantity.toLocaleString()}</td>
                    <td>${record.note}</td>
                    <td class="action-btns">
                        <button class="action-btn btn-danger" onclick="deleteIncoming(${record.id})">ì‚­ì œ</button>
                    </td>
                `;
            });
        }

        // ì¶œê³  ë‚´ì—­ ë¡œë“œ
        function loadOutgoing() {
            const tbody = document.getElementById('outgoing-table').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            
            outgoing.forEach((record, index) => {
                const material = materials.find(m => m.id === record.materialId);
                if (!material) return;
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${material.name}</td>
                    <td>${material.spec}</td>
                    <td>${material.unit}</td>
                    <td>${record.date}</td>
                    <td>${record.quantity.toLocaleString()}</td>
                    <td>${record.note}</td>
                    <td class="action-btns">
                        <button class="action-btn btn-danger" onclick="deleteOutgoing(${record.id})">ì‚­ì œ</button>
                    </td>
                `;
            });
        }

        // ì „ì²´ ë‚´ì—­ ë¡œë“œ
        function loadHistory() {
            const tbody = document.getElementById('history-table').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            
            materials.forEach((material, index) => {
                const incomingRecords = incoming.filter(i => i.materialId === material.id);
                const outgoingRecords = outgoing.filter(o => o.materialId === material.id);
                
                const incomingQty = getIncomingQuantity(material.id);
                const outgoingQty = getOutgoingQuantity(material.id);
                const remaining = incomingQty - outgoingQty;
                
                const maxRecords = Math.max(incomingRecords.length, outgoingRecords.length, 1);
                
                for (let i = 0; i < maxRecords; i++) {
                    const inRecord = incomingRecords[i];
                    const outRecord = outgoingRecords[i];
                    
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${i === 0 ? index + 1 : ''}</td>
                        <td>${i === 0 ? material.name : ''}</td>
                        <td>${i === 0 ? material.spec : ''}</td>
                        <td>${i === 0 ? material.unit : ''}</td>
                        <td>${i === 0 ? material.contractQty.toLocaleString() : ''}</td>
                        <td>${inRecord ? inRecord.date : ''}</td>
                        <td>${inRecord ? inRecord.quantity.toLocaleString() : ''}</td>
                        <td>${outRecord ? outRecord.date : ''}</td>
                        <td>${outRecord ? outRecord.quantity.toLocaleString() : ''}</td>
                        <td>${i === 0 ? remaining.toLocaleString() : ''}</td>
                        <td>${i === 0 ? material.note : ''}</td>
                    `;
                }
            });
        }

        // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
        function updateDashboard() {
            const tbody = document.getElementById('low-stock-table').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            
            const materialsWithHistory = materials.filter(material => {
                const incomingQty = getIncomingQuantity(material.id);
                const outgoingQty = getOutgoingQuantity(material.id);
                return incomingQty > 0 || outgoingQty > 0;
            });
            
            materialsWithHistory.forEach((material, index) => {
                const incomingQty = getIncomingQuantity(material.id);
                const outgoingQty = getOutgoingQuantity(material.id);
                const remaining = incomingQty - outgoingQty;
                const percentage = incomingQty > 0 ? ((incomingQty - remaining) / incomingQty * 100).toFixed(1) : 0;
                
                const row = tbody.insertRow();
                if (incomingQty > 0 && remaining < incomingQty * 0.2) {
                    row.classList.add('low-stock');
                }
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${material.name}</td>
                    <td>${material.spec}</td>
                    <td>${material.unit}</td>
                    <td>${material.contractQty.toLocaleString()}</td>
                    <td>${incomingQty.toLocaleString()}</td>
                    <td>${outgoingQty.toLocaleString()}</td>
                    <td>${remaining.toLocaleString()}</td>
                    <td>${percentage}%</td>
                    <td>${material.note}</td>
                `;
            });
            
            if (materialsWithHistory.length === 0) {
                const row = tbody.insertRow();
                row.innerHTML = '<td colspan="10" style="text-align: center; padding: 30px;">ì…ì¶œê³  ë‚´ì—­ì´ ìˆëŠ” ìì¬ê°€ ì—†ìŠµë‹ˆë‹¤.</td>';
            }
        }

        // ìì¬ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ (ì…ê³ ìš©)
        function updateMaterialSelects() {
            const inNameSelect = document.getElementById('in-material-name');
            const inSpecSelect = document.getElementById('in-material-spec');
            
            inNameSelect.innerHTML = '<option value="">í’ˆëª…ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            inSpecSelect.innerHTML = '<option value="">ê·œê²©ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            
            const uniqueNames = [...new Set(materials.map(m => m.name))];
            
            uniqueNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                inNameSelect.appendChild(option);
            });
        }

        // ìì¬ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ (ì¶œê³ ìš© - ì…ê³ ëœ ìì¬ë§Œ)
        function updateOutgoingMaterialSelects() {
            const outNameSelect = document.getElementById('out-material-name');
            const outSpecSelect = document.getElementById('out-material-spec');
            
            outNameSelect.innerHTML = '<option value="">í’ˆëª…ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            outSpecSelect.innerHTML = '<option value="">ê·œê²©ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            
            const materialsWithIncoming = materials.filter(m => {
                const incomingQty = getIncomingQuantity(m.id);
                return incomingQty > 0;
            });
            
            const uniqueNames = [...new Set(materialsWithIncoming.map(m => m.name))];
            
            uniqueNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                outNameSelect.appendChild(option);
            });
        }

        // ì…ê³  - í’ˆëª… ì„ íƒ ì‹œ ê·œê²© í•„í„°ë§
        function onIncomingNameChange() {
            const selectedName = document.getElementById('in-material-name').value;
            const specSelect = document.getElementById('in-material-spec');
            
            specSelect.innerHTML = '<option value="">ê·œê²©ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            
            if (!selectedName) return;
            
            const filteredMaterials = materials.filter(m => m.name === selectedName);
            const filteredSpecs = [...new Set(filteredMaterials.map(m => m.spec))];
            
            filteredSpecs.forEach(spec => {
                const option = document.createElement('option');
                option.value = spec;
                option.textContent = spec;
                specSelect.appendChild(option);
            });
            
            if (filteredSpecs.length === 1) {
                specSelect.value = filteredSpecs[0];
            }
        }

        function onIncomingSpecChange() {
            // í•„ìš” ì‹œ ì¶”ê°€ ë™ì‘
        }

        // ì¶œê³  - í’ˆëª… ì„ íƒ ì‹œ ê·œê²© í•„í„°ë§ (ì…ê³ ëœ ìì¬ë§Œ)
        function onOutgoingNameChange() {
            const selectedName = document.getElementById('out-material-name').value;
            const specSelect = document.getElementById('out-material-spec');
            
            specSelect.innerHTML = '<option value="">ê·œê²©ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            
            if (!selectedName) return;
            
            const materialsWithIncoming = materials.filter(m => {
                const incomingQty = getIncomingQuantity(m.id);
                return m.name === selectedName && incomingQty > 0;
            });
            
            const filteredSpecs = [...new Set(materialsWithIncoming.map(m => m.spec))];
            
            filteredSpecs.forEach(spec => {
                const option = document.createElement('option');
                option.value = spec;
                option.textContent = spec;
                specSelect.appendChild(option);
            });
            
            if (filteredSpecs.length === 1) {
                specSelect.value = filteredSpecs[0];
            }
        }

        function onOutgoingSpecChange() {
            // í•„ìš” ì‹œ ì¶”ê°€ ë™ì‘
        }

        // ìì¬ ë“±ë¡ í¼ì˜ í’ˆëª… ì„ íƒ (ì—‘ì…€ ì—…ë¡œë“œìš©)
        function onMaterialNameChange() {
            const selectedName = document.getElementById('mat-name').value;
            const specSelect = document.getElementById('mat-spec');
            
            specSelect.innerHTML = '<option value="">ê·œê²©ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            
            if (!selectedName) {
                const uniqueSpecs = [...new Set(uploadedMaterials.map(m => m.spec))];
                uniqueSpecs.forEach(spec => {
                    const option = document.createElement('option');
                    option.value = spec;
                    option.textContent = spec;
                    specSelect.appendChild(option);
                });
                return;
            }
            
            const filteredMaterials = uploadedMaterials.filter(m => m.name === selectedName);
            const filteredSpecs = [...new Set(filteredMaterials.map(m => m.spec))];
            
            filteredSpecs.forEach(spec => {
                const option = document.createElement('option');
                option.value = spec;
                option.textContent = spec;
                specSelect.appendChild(option);
            });
            
            if (filteredSpecs.length === 1) {
                specSelect.value = filteredSpecs[0];
                fillMaterialData(selectedName, filteredSpecs[0]);
            }
        }

        // ê·œê²© ì„ íƒ ì‹œ ìë™ ì™„ì„±
        document.addEventListener('DOMContentLoaded', function() {
            const matSpec = document.getElementById('mat-spec');
            if (matSpec) {
                matSpec.addEventListener('change', function() {
                    const selectedName = document.getElementById('mat-name').value;
                    const selectedSpec = this.value;
                    
                    if (selectedName && selectedSpec) {
                        fillMaterialData(selectedName, selectedSpec);
                    }
                });
            }
        });

        // ìì¬ ë°ì´í„° ìë™ ì±„ìš°ê¸°
        function fillMaterialData(name, spec) {
            const matchedMaterial = uploadedMaterials.find(m => m.name === name && m.spec === spec);
            
            if (matchedMaterial) {
                document.getElementById('mat-unit').value = matchedMaterial.unit;
                document.getElementById('mat-quantity').value = matchedMaterial.contractQty;
                document.getElementById('mat-note').value = matchedMaterial.note;
            }
        }

        // ì—‘ì…€ ì—…ë¡œë“œ
        function uploadExcel() {
            const fileInput = document.getElementById('excel-upload');
            const file = fileInput.files[0];
            
            if (!file) {
                showAlert('materials-alert', 'íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                    
                    const rows = jsonData.slice(1);
                    
                    uploadedMaterials = [];
                    let successCount = 0;
                    let duplicateCount = 0;
                    let uploadPromises = [];
                    
                    rows.forEach(row => {
                        if (row.length >= 4 && row[0] && row[1] && row[2] && row[3]) {
                            const materialData = {
                                name: String(row[0]).trim(),
                                spec: String(row[1]).trim(),
                                unit: String(row[2]).trim(),
                                contractQty: parseFloat(row[3]) || 0,
                                note: row[4] ? String(row[4]).trim() : ''
                            };
                            
                            const isDuplicate = materials.some(m => 
                                m.name === materialData.name && m.spec === materialData.spec
                            );
                            
                            if (!isDuplicate) {
                                const newMaterial = {
                                    id: Date.now() + successCount,
                                    ...materialData
                                };
                                
                                uploadPromises.push(
                                    database.ref('materials/' + newMaterial.id).set(newMaterial)
                                );
                                uploadedMaterials.push(materialData);
                                successCount++;
                            } else {
                                duplicateCount++;
                            }
                        }
                    });
                    
                    Promise.all(uploadPromises).then(() => {
                        let message = `${successCount}ê°œì˜ ìì¬ê°€ ìë™ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`;
                        if (duplicateCount > 0) {
                            message += ` (ì¤‘ë³µ ${duplicateCount}ê°œ ì œì™¸)`;
                        }
                        showAlert('materials-alert', message, 'success');
                        updateMaterialDatalist();
                    }).catch(error => {
                        showAlert('materials-alert', 'ì—…ë¡œë“œ ì‹¤íŒ¨: ' + error.message, 'error');
                    });
                    
                    fileInput.value = '';
                    
                } catch (error) {
                    showAlert('materials-alert', 'íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: ' + error.message, 'error');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        // ìì¬ ë°ì´í„°ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        function updateMaterialDatalist() {
            const nameSelect = document.getElementById('mat-name');
            const specSelect = document.getElementById('mat-spec');
            const unitDatalist = document.getElementById('material-unit-list');
            
            nameSelect.innerHTML = '<option value="">í’ˆëª…ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            specSelect.innerHTML = '<option value="">ê·œê²©ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            unitDatalist.innerHTML = '';
            
            const uniqueNames = [...new Set(uploadedMaterials.map(m => m.name))];
            const uniqueSpecs = [...new Set(uploadedMaterials.map(m => m.spec))];
            const uniqueUnits = [...new Set(uploadedMaterials.map(m => m.unit))];
            
            uniqueNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                nameSelect.appendChild(option);
            });
            
            uniqueSpecs.forEach(spec => {
                const option = document.createElement('option');
                option.value = spec;
                option.textContent = spec;
                specSelect.appendChild(option);
            });
            
            uniqueUnits.forEach(unit => {
                const option = document.createElement('option');
                option.value = unit;
                unitDatalist.appendChild(option);
            });
        }

        // ì…ê³ /ì¶œê³ /ì‚¬ìš© ìˆ˜ëŸ‰ ê³„ì‚°
        function getIncomingQuantity(materialId) {
            return incoming
                .filter(i => i.materialId === materialId)
                .reduce((sum, i) => sum + i.quantity, 0);
        }

        function getOutgoingQuantity(materialId) {
            return outgoing
                .filter(o => o.materialId === materialId)
                .reduce((sum, o) => sum + o.quantity, 0);
        }

        function getAvailableQuantity(materialId) {
            return getIncomingQuantity(materialId) - getOutgoingQuantity(materialId);
        }

        // ìì¬ ì‚­ì œ
        function deleteMaterial(id) {
            // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
            if (!checkDeletePassword()) {
                return;
            }
            
            if (!confirm('ì´ ìì¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nê´€ë ¨ëœ ëª¨ë“  ì…ì¶œê³  ë‚´ì—­ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.')) return;
            
            const relatedIncoming = incoming.filter(i => i.materialId === id);
            const relatedOutgoing = outgoing.filter(o => o.materialId === id);
            
            let deletePromises = [database.ref('materials/' + id).remove()];
            
            relatedIncoming.forEach(record => {
                deletePromises.push(database.ref('incoming/' + record.id).remove());
            });
            
            relatedOutgoing.forEach(record => {
                deletePromises.push(database.ref('outgoing/' + record.id).remove());
            });
            
            Promise.all(deletePromises)
                .then(() => {
                    showAlert('materials-alert', 'ìì¬ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                })
                .catch((error) => {
                    showAlert('materials-alert', 'ì‚­ì œ ì‹¤íŒ¨: ' + error.message, 'error');
                });
        }

        // ì…ê³  ì‚­ì œ
        function deleteIncoming(id) {
            // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
            if (!checkDeletePassword()) {
                return;
            }
            
            if (!confirm('ì´ ì…ê³  ë‚´ì—­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            database.ref('incoming/' + id).remove()
                .then(() => {
                    showAlert('incoming-alert', 'ì…ê³  ë‚´ì—­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                })
                .catch((error) => {
                    showAlert('incoming-alert', 'ì‚­ì œ ì‹¤íŒ¨: ' + error.message, 'error');
                });
        }

        // ì¶œê³  ì‚­ì œ
        function deleteOutgoing(id) {
            // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
            if (!checkDeletePassword()) {
                return;
            }
            
            if (!confirm('ì´ ì‚¬ìš©(ì¶œê³ ) ë‚´ì—­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            database.ref('outgoing/' + id).remove()
                .then(() => {
                    showAlert('outgoing-alert', 'ì‚¬ìš©(ì¶œê³ ) ë‚´ì—­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                })
                .catch((error) => {
                    showAlert('outgoing-alert', 'ì‚­ì œ ì‹¤íŒ¨: ' + error.message, 'error');
                });
        }

        // í¼ ì´ˆê¸°í™”
        function resetMaterialForm() {
            document.getElementById('material-form').reset();
            document.getElementById('mat-name').value = '';
            document.getElementById('mat-spec').value = '';
            updateMaterialDatalist();
        }

        function resetIncomingForm() {
            document.getElementById('incoming-form').reset();
            document.getElementById('in-material-name').value = '';
            document.getElementById('in-material-spec').value = '';
            setTodayDate();
            updateMaterialSelects();
        }

        function resetOutgoingForm() {
            document.getElementById('outgoing-form').reset();
            document.getElementById('out-material-name').value = '';
            document.getElementById('out-material-spec').value = '';
            setTodayDate();
            updateOutgoingMaterialSelects();
        }

        // ê²€ìƒ‰ ê¸°ëŠ¥
        function searchMaterials() {
            const searchText = document.getElementById('material-search').value.toLowerCase();
            const rows = document.getElementById('materials-table').getElementsByTagName('tbody')[0].rows;
            
            Array.from(rows).forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchText) ? '' : 'none';
            });
        }

        function searchIncoming() {
            const searchText = document.getElementById('incoming-search').value.toLowerCase();
            const rows = document.getElementById('incoming-table').getElementsByTagName('tbody')[0].rows;
            
            Array.from(rows).forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchText) ? '' : 'none';
            });
        }

        function searchOutgoing() {
            const searchText = document.getElementById('outgoing-search').value.toLowerCase();
            const rows = document.getElementById('outgoing-table').getElementsByTagName('tbody')[0].rows;
            
            Array.from(rows).forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchText) ? '' : 'none';
            });
        }

        function searchHistory() {
            const searchText = document.getElementById('history-search').value.toLowerCase();
            const rows = document.getElementById('history-table').getElementsByTagName('tbody')[0].rows;
            
            Array.from(rows).forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchText) ? '' : 'none';
            });
        }

        // Excel ë‹¤ìš´ë¡œë“œ (ê¸°ì¡´ í•¨ìˆ˜ ìœ ì§€)
        function exportToExcel(type) {
            let csvContent = '';
            let filename = '';
            
            switch(type) {
                case 'materials':
                    csvContent = 'ë²ˆí˜¸,í’ˆëª…,ê·œê²©,ë‹¨ìœ„,ê³„ì•½ìˆ˜ëŸ‰,ì…ê³ ìˆ˜ëŸ‰,ì‚¬ìš©ìˆ˜ëŸ‰,ì”ì—¬ìˆ˜ëŸ‰,ë¹„ê³ \n';
                    materials.forEach((material, index) => {
                        const incomingQty = getIncomingQuantity(material.id);
                        const outgoingQty = getOutgoingQuantity(material.id);
                        const remaining = incomingQty - outgoingQty;
                        csvContent += `${index + 1},${material.name},${material.spec},${material.unit},${material.contractQty},${incomingQty},${outgoingQty},${remaining},${material.note}\n`;
                    });
                    filename = 'ìì¬ëª©ë¡.csv';
                    break;
                    
                case 'incoming':
                    csvContent = 'ë²ˆí˜¸,í’ˆëª…,ê·œê²©,ë‹¨ìœ„,ì…ê³ ì¼,ì…ê³ ìˆ˜ëŸ‰,ë¹„ê³ \n';
                    incoming.forEach((record, index) => {
                        const material = materials.find(m => m.id === record.materialId);
                        if (material) {
                            csvContent += `${index + 1},${material.name},${material.spec},${material.unit},${record.date},${record.quantity},${record.note}\n`;
                        }
                    });
                    filename = 'ì…ê³ ë‚´ì—­.csv';
                    break;
                    
                case 'outgoing':
                    csvContent = 'ë²ˆí˜¸,í’ˆëª…,ê·œê²©,ë‹¨ìœ„,ì‚¬ìš©ì¼,ì‚¬ìš©ìˆ˜ëŸ‰,ë¹„ê³ \n';
                    outgoing.forEach((record, index) => {
                        const material = materials.find(m => m.id === record.materialId);
                        if (material) {
                            csvContent += `${index + 1},${material.name},${material.spec},${material.unit},${record.date},${record.quantity},${record.note}\n`;
                        }
                    });
                    filename = 'ì‚¬ìš©ë‚´ì—­.csv';
                    break;
                    
                case 'history':
                    csvContent = 'ë²ˆí˜¸,í’ˆëª…,ê·œê²©,ë‹¨ìœ„,ê³„ì•½ìˆ˜ëŸ‰,ì…ê³ ì¼,ì…ê³ ìˆ˜ëŸ‰,ì‚¬ìš©ì¼,ì‚¬ìš©ìˆ˜ëŸ‰,ì”ì—¬ìˆ˜ëŸ‰,ë¹„ê³ \n';
                    materials.forEach((material, index) => {
                        const incomingRecords = incoming.filter(i => i.materialId === material.id);
                        const outgoingRecords = outgoing.filter(o => o.materialId === material.id);
                        const remaining = getAvailableQuantity(material.id);
                        
                        const maxRecords = Math.max(incomingRecords.length, outgoingRecords.length, 1);
                        
                        for (let i = 0; i < maxRecords; i++) {
                            const inRecord = incomingRecords[i];
                            const outRecord = outgoingRecords[i];
                            
                            csvContent += `${i === 0 ? index + 1 : ''},`;
                            csvContent += `${i === 0 ? material.name : ''},`;
                            csvContent += `${i === 0 ? material.spec : ''},`;
                            csvContent += `${i === 0 ? material.unit : ''},`;
                            csvContent += `${i === 0 ? material.contractQty : ''},`;
                            csvContent += `${inRecord ? inRecord.date : ''},`;
                            csvContent += `${inRecord ? inRecord.quantity : ''},`;
                            csvContent += `${outRecord ? outRecord.date : ''},`;
                            csvContent += `${outRecord ? outRecord.quantity : ''},`;
                            csvContent += `${i === 0 ? remaining : ''},`;
                            csvContent += `${i === 0 ? material.note : ''}\n`;
                        }
                    });
                    filename = 'ì „ì²´ë‚´ì—­.csv';
                    break;
            }
            
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }
    </script>
</body>
</html>
