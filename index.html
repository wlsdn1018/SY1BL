<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µì‚¬ê´€ë¦¬ í”„ë¡œê·¸ë¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: white;
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }

        .container {
            width: 100%;
            height: 100vh;
            margin: 0;
            background: white;
            overflow: auto;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .header p {
            margin: 0;
            font-size: 0.9em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: #f5f5f5;
            border: none;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 15px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 5px;
            font-size: 14px;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
            position: sticky;
            top: 0;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .action-btns {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .stat-card h3 {
            font-size: 14px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
        }

        .low-stock {
            background: #ffebee !important;
        }

        .low-stock td:last-child::after {
            content: " âš ï¸";
            color: #f44336;
        }

        .completed-item {
            text-decoration: line-through;
            text-decoration-color: #f44336;
            text-decoration-thickness: 2px;
            opacity: 0.7;
        }

        .checkbox-cell {
            text-align: center;
        }

        .checkbox-cell input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        @media print {
            .tabs, .btn-group, .search-box, .action-btns {
                display: none !important;
            }
            
            body {
                background: white;
            }
            
            .container {
                box-shadow: none;
            }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }

        .close:hover {
            color: #000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—ï¸ ê³µì‚¬ê´€ë¦¬ í”„ë¡œê·¸ë¨</h1>
            <p>ìì¬ ê´€ë¦¬ ë° ì—…ë¬´ í˜„í™© í†µí•© ì‹œìŠ¤í…œ</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
            <button class="tab" onclick="showTab('notices')">ğŸ“¢ ê³µì§€ì‚¬í•­</button>
            <button class="tab" onclick="showTab('team-status')">ğŸ‘¥ íŒ€ë³„ ì—…ë¬´í˜„í™©</button>
            <button class="tab" onclick="showTab('materials')">ğŸ“¦ ìì¬ ëª©ë¡</button>
            <button class="tab" onclick="showTab('incoming')">ğŸ“¥ ì…ê³  ê´€ë¦¬</button>
            <button class="tab" onclick="showTab('outgoing')">ğŸ“¤ ì‚¬ìš©(ì¶œê³ ) ê´€ë¦¬</button>
            <button class="tab" onclick="showTab('history')">ğŸ“‹ ì „ì²´ ë‚´ì—­</button>
        </div>

        <!-- ëŒ€ì‹œë³´ë“œ íƒ­ -->
        <div id="dashboard" class="tab-content active">
            <div class="alert" id="dashboard-alert"></div>
            
            <div class="stats-container">
                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <h3>ğŸ“¢ ê³µì§€ì‚¬í•­ (ìµœê·¼ 5ê°œ)</h3>
                    <div id="notice-list" style="margin-top: 15px; max-height: 200px; overflow-y: auto;">
                        <p style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                    <button onclick="showTab('notices'); event.stopPropagation();" class="btn btn-primary" style="margin-top: 10px; width: 100%; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);">ê³µì§€ì‚¬í•­ ê´€ë¦¬</button>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <h3>ğŸ‘¥ íŒ€ë³„ ì—…ë¬´í˜„í™© (ìµœê·¼ 5ê°œ)</h3>
                    <div id="team-status-list" style="margin-top: 15px; max-height: 200px; overflow-y: auto;">
                        <p style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">ë“±ë¡ëœ ì—…ë¬´í˜„í™©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                    <button onclick="showTab('team-status'); event.stopPropagation();" class="btn btn-primary" style="margin-top: 10px; width: 100%; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);">ì—…ë¬´í˜„í™© ê´€ë¦¬</button>
                </div>
            </div>

            <h2 style="margin-bottom: 15px;">ğŸ“‹ ìì¬ í˜„í™©</h2>
            <div class="table-container">
                <table id="low-stock-table">
                    <thead>
                        <tr>
                            <th>ë²ˆí˜¸</th>
                            <th>í’ˆëª…</th>
                            <th>ê·œê²©</th>
                            <th>ë‹¨ìœ„</th>
                            <th>ê³„ì•½ìˆ˜ëŸ‰</th>
                            <th>ì…ê³ ìˆ˜ëŸ‰</th>
                            <th>ì‚¬ìš©ìˆ˜ëŸ‰</th>
                            <th>ì”ì—¬ìˆ˜ëŸ‰</th>
                            <th>ë¶€ì¡±ë¥ </th>
                            <th>ë¹„ê³ </th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- ê³µì§€ì‚¬í•­ íƒ­ -->
        <div id="notices" class="tab-content">
            <div class="alert" id="notices-alert"></div>
            
            <div class="form-section">
                <h2 style="margin-bottom: 15px;">ğŸ“¢ ê³µì§€ì‚¬í•­ ë“±ë¡</h2>
                <form id="notice-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>ì œëª© *</label>
                            <input type="text" id="notice-title" required>
                        </div>
                        <div class="form-group">
                            <label>ì‘ì„±ì¼ *</label>
                            <input type="date" id="notice-date" required>
                        </div>
                        <div class="form-group">
                            <label>ì™„ë£Œê¸°í•œ</label>
                            <input type="date" id="notice-deadline">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ë‚´ìš© *</label>
                            <textarea id="notice-content" required style="min-height: 100px;"></textarea>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">ê³µì§€ì‚¬í•­ ë“±ë¡</button>
                        <button type="button" class="btn btn-warning" onclick="resetNoticeForm()">ì´ˆê¸°í™”</button>
                    </div>
                </form>
            </div>

            <div class="search-box">
                <input type="text" id="notice-search" placeholder="ğŸ” ì œëª©, ë‚´ìš©ìœ¼ë¡œ ê²€ìƒ‰..." onkeyup="searchNotices()">
            </div>

            <div class="table-container">
                <table id="notices-table">
                    <thead>
                        <tr>
                            <th>ë²ˆí˜¸</th>
                            <th>ì™„ë£Œ</th>
                            <th>ì œëª©</th>
                            <th>ë‚´ìš©</th>
                            <th>ì‘ì„±ì¼</th>
                            <th>ì™„ë£Œê¸°í•œ</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- íŒ€ë³„ ì—…ë¬´í˜„í™© íƒ­ -->
        <div id="team-status" class="tab-content">
            <div class="alert" id="team-status-alert"></div>
            
            <div class="form-section">
                <h2 style="margin-bottom: 15px;">ğŸ‘¥ íŒ€ë³„ ì—…ë¬´í˜„í™© ë“±ë¡</h2>
                <form id="team-status-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>íŒ€ëª… *</label>
                            <input type="text" id="team-name" required>
                        </div>
                        <div class="form-group">
                            <label>ì‘ì„±ì¼ *</label>
                            <input type="date" id="team-date" required>
                        </div>
                        <div class="form-group">
                            <label>ì™„ë£Œê¸°í•œ</label>
                            <input type="date" id="team-deadline">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ì—…ë¬´ë‚´ìš© *</label>
                            <textarea id="team-content" required style="min-height: 100px;"></textarea>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">ì—…ë¬´í˜„í™© ë“±ë¡</button>
                        <button type="button" class="btn btn-warning" onclick="resetTeamStatusForm()">ì´ˆê¸°í™”</button>
                    </div>
                </form>
            </div>

            <div class="search-box">
                <input type="text" id="team-status-search" placeholder="ğŸ” íŒ€ëª…, ì—…ë¬´ë‚´ìš©ìœ¼ë¡œ ê²€ìƒ‰..." onkeyup="searchTeamStatus()">
            </div>

            <div class="table-container">
                <table id="team-status-table">
                    <thead>
                        <tr>
                            <th>ë²ˆí˜¸</th>
                            <th>ì™„ë£Œ</th>
                            <th>íŒ€ëª…</th>
                            <th>ì—…ë¬´ë‚´ìš©</th>
                            <th>ì‘ì„±ì¼</th>
                            <th>ì™„ë£Œê¸°í•œ</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- ìì¬ ëª©ë¡ íƒ­ -->
        <div id="materials" class="tab-content">
            <div class="alert" id="materials-alert"></div>
            
            <div class="form-section">
                <h2 style="margin-bottom: 15px;">â• ìì¬ ë“±ë¡</h2>
                
                <div style="margin-bottom: 20px; padding: 15px; background: #e3f2fd; border-radius: 5px;">
                    <h3 style="margin-bottom: 10px;">ğŸ“ ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ (ìë™ ë“±ë¡)</h3>
                    <p style="font-size: 13px; color: #666; margin-bottom: 10px;">ì—‘ì…€ íŒŒì¼ í˜•ì‹: í’ˆëª…, ê·œê²©, ë‹¨ìœ„, ê³„ì•½ìˆ˜ëŸ‰, ë¹„ê³  (ì²« ë²ˆì§¸ í–‰ì€ í—¤ë”)</p>
                    <p style="font-size: 13px; color: #d32f2f; margin-bottom: 10px;">â€» ì—…ë¡œë“œ ì‹œ ì¤‘ë³µë˜ì§€ ì•Šì€ ìì¬ê°€ ìë™ìœ¼ë¡œ ë“±ë¡ë©ë‹ˆë‹¤.</p>
                    <input type="file" id="excel-upload" accept=".xlsx,.xlsm,.xlsb,.xls,.csv" style="padding: 10px; border: 2px solid #2196F3; border-radius: 5px; background: white;">
                    <button type="button" class="btn btn-info" onclick="uploadExcel()" style="margin-left: 10px;">ì—…ë¡œë“œ ë° ìë™ ë“±ë¡</button>
                </div>
                
                <form id="material-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>í’ˆëª… *</label>
                            <select id="mat-name" required onchange="onMaterialNameChange()">
                                <option value="">í’ˆëª…ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ê·œê²© *</label>
                            <select id="mat-spec" required>
                                <option value="">ê·œê²©ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ë‹¨ìœ„ *</label>
                            <input type="text" id="mat-unit" required list="material-unit-list">
                            <datalist id="material-unit-list"></datalist>
                        </div>
                        <div class="form-group">
                            <label>ê³„ì•½ìˆ˜ëŸ‰ *</label>
                            <input type="number" id="mat-quantity" required min="0" step="0.01">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ë¹„ê³ </label>
                            <textarea id="mat-note"></textarea>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">ìì¬ ë“±ë¡</button>
                        <button type="button" class="btn btn-warning" onclick="resetMaterialForm()">ì´ˆê¸°í™”</button>
                    </div>
                </form>
            </div>

            <div class="search-box">
                <input type="text" id="material-search" placeholder="ğŸ” ìì¬ëª…, ê·œê²©ìœ¼ë¡œ ê²€ìƒ‰..." onkeyup="searchMaterials()">
            </div>

            <div class="btn-group">
                <button class="btn btn-success" onclick="exportToExcel('materials')">ğŸ“¥ Excel ë‹¤ìš´ë¡œë“œ</button>
                <button class="btn btn-info" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„</button>
            </div>

            <div class="table-container">
                <table id="materials-table">
                    <thead>
                        <tr>
                            <th>ë²ˆí˜¸</th>
                            <th>í’ˆëª…</th>
                            <th>ê·œê²©</th>
                            <th>ë‹¨ìœ„</th>
                            <th>ê³„ì•½ìˆ˜ëŸ‰</th>
                            <th>ì…ê³ ìˆ˜ëŸ‰</th>
                            <th>ì‚¬ìš©ìˆ˜ëŸ‰</th>
                            <th>ì”ì—¬ìˆ˜ëŸ‰</th>
                            <th>ë¹„ê³ </th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- ì…ê³  ê´€ë¦¬ íƒ­ -->
        <div id="incoming" class="tab-content">
            <div class="alert" id="incoming-alert"></div>
            
            <div class="form-section">
                <h2 style="margin-bottom: 15px;">ğŸ“¥ ì…ê³  ë“±ë¡</h2>
                <form id="incoming-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>í’ˆëª… *</label>
                            <select id="in-material-name" required onchange="onIncomingNameChange()">
                                <option value="">í’ˆëª…ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ê·œê²© *</label>
                            <select id="in-material-spec" required onchange="onIncomingSpecChange()">
                                <option value="">ê·œê²©ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ì…ê³ ì¼ *</label>
                            <input type="date" id="in-date" required>
                        </div>
                        <div class="form-group">
                            <label>ì…ê³ ìˆ˜ëŸ‰ *</label>
                            <input type="number" id="in-quantity" required min="0.01" step="0.01">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ë¹„ê³ </label>
                            <textarea id="in-note"></textarea>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">ì…ê³  ë“±ë¡</button>
                        <button type="button" class="btn btn-warning" onclick="resetIncomingForm()">ì´ˆê¸°í™”</button>
                    </div>
                </form>
            </div>

            <div class="search-box">
                <input type="text" id="incoming-search" placeholder="ğŸ” ìì¬ëª…ìœ¼ë¡œ ê²€ìƒ‰..." onkeyup="searchIncoming()">
            </div>

            <div class="btn-group">
                <button class="btn btn-success" onclick="exportToExcel('incoming')">ğŸ“¥ Excel ë‹¤ìš´ë¡œë“œ</button>
            </div>

            <div class="table-container">
                <table id="incoming-table">
                    <thead>
                        <tr>
                            <th>ë²ˆí˜¸</th>
                            <th>í’ˆëª…</th>
                            <th>ê·œê²©</th>
                            <th>ë‹¨ìœ„</th>
                            <th>ì…ê³ ì¼</th>
                            <th>ì…ê³ ìˆ˜ëŸ‰</th>
                            <th>ë¹„ê³ </th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- ì‚¬ìš©(ì¶œê³ ) ê´€ë¦¬ íƒ­ -->
        <div id="outgoing" class="tab-content">
            <div class="alert" id="outgoing-alert"></div>
            
            <div class="form-section">
                <h2 style="margin-bottom: 15px;">ğŸ“¤ ì‚¬ìš©(ì¶œê³ ) ë“±ë¡</h2>
                <form id="outgoing-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>í’ˆëª… *</label>
                            <select id="out-material-name" required onchange="onOutgoingNameChange()">
                                <option value="">í’ˆëª…ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ê·œê²© *</label>
                            <select id="out-material-spec" required onchange="onOutgoingSpecChange()">
                                <option value="">ê·œê²©ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ì‚¬ìš©ì¼ *</label>
                            <input type="date" id="out-date" required>
                        </div>
                        <div class="form-group">
                            <label>ì‚¬ìš©ìˆ˜ëŸ‰ *</label>
                            <input type="number" id="out-quantity" required min="0.01" step="0.01">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ë¹„ê³ </label>
                            <textarea id="out-note"></textarea>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">ì‚¬ìš© ë“±ë¡</button>
                        <button type="button" class="btn btn-warning" onclick="resetOutgoingForm()">ì´ˆê¸°í™”</button>
                    </div>
                </form>
            </div>

            <div class="search-box">
                <input type="text" id="outgoing-search" placeholder="ğŸ” ìì¬ëª…ìœ¼ë¡œ ê²€ìƒ‰..." onkeyup="searchOutgoing()">
            </div>

            <div class="btn-group">
                <button class="btn btn-success" onclick="exportToExcel('outgoing')">ğŸ“¥ Excel ë‹¤ìš´ë¡œë“œ</button>
            </div>

            <div class="table-container">
                <table id="outgoing-table">
                    <thead>
                        <tr>
                            <th>ë²ˆí˜¸</th>
                            <th>í’ˆëª…</th>
                            <th>ê·œê²©</th>
                            <th>ë‹¨ìœ„</th>
                            <th>ì‚¬ìš©ì¼</th>
                            <th>ì‚¬ìš©ìˆ˜ëŸ‰</th>
                            <th>ë¹„ê³ </th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- ì „ì²´ ë‚´ì—­ íƒ­ -->
        <div id="history" class="tab-content">
            <div class="alert" id="history-alert"></div>
            
            <div class="search-box">
                <input type="text" id="history-search" placeholder="ğŸ” ìì¬ëª…ìœ¼ë¡œ ê²€ìƒ‰..." onkeyup="searchHistory()">
            </div>

            <div class="btn-group">
                <button class="btn btn-success" onclick="exportToExcel('history')">ğŸ“¥ Excel ë‹¤ìš´ë¡œë“œ</button>
            </div>

            <div class="table-container">
                <table id="history-table">
                    <thead>
                        <tr>
                            <th>ë²ˆí˜¸</th>
                            <th>í’ˆëª…</th>
                            <th>ê·œê²©</th>
                            <th>ë‹¨ìœ„</th>
                            <th>ê³„ì•½ìˆ˜ëŸ‰</th>
                            <th>ì…ê³ ì¼</th>
                            <th>ì…ê³ ìˆ˜ëŸ‰</th>
                            <th>ì‚¬ìš©ì¼</th>
                            <th>ì‚¬ìš©ìˆ˜ëŸ‰</th>
                            <th>ì”ì—¬ìˆ˜ëŸ‰</th>
                            <th>ë¹„ê³ </th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- SheetJS ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        // ë°ì´í„° ì €ì¥ì†Œ
        let materials = JSON.parse(localStorage.getItem('materials')) || [];
        let incoming = JSON.parse(localStorage.getItem('incoming')) || [];
        let outgoing = JSON.parse(localStorage.getItem('outgoing')) || [];
        let uploadedMaterials = JSON.parse(localStorage.getItem('uploadedMaterials')) || [];
        let notices = JSON.parse(localStorage.getItem('notices')) || [];
        let teamStatuses = JSON.parse(localStorage.getItem('teamStatuses')) || [];

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            setTodayDate();
            updateMaterialDatalist();
        });

        function setTodayDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('in-date').value = today;
            document.getElementById('out-date').value = today;
            document.getElementById('notice-date').value = today;
            document.getElementById('team-date').value = today;
        }

        // ê³µì§€ì‚¬í•­ ë“±ë¡
        document.getElementById('notice-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const notice = {
                id: Date.now(),
                title: document.getElementById('notice-title').value,
                content: document.getElementById('notice-content').value,
                date: document.getElementById('notice-date').value,
                deadline: document.getElementById('notice-deadline').value || '',
                completed: false
            };
            
            notices.push(notice);
            localStorage.setItem('notices', JSON.stringify(notices));
            
            showAlert('notices-alert', 'ê³µì§€ì‚¬í•­ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            resetNoticeForm();
            loadNotices();
        });

        // íŒ€ë³„ ì—…ë¬´í˜„í™© ë“±ë¡
        document.getElementById('team-status-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const teamStatus = {
                id: Date.now(),
                teamName: document.getElementById('team-name').value,
                content: document.getElementById('team-content').value,
                date: document.getElementById('team-date').value,
                deadline: document.getElementById('team-deadline').value || '',
                completed: false
            };
            
            teamStatuses.push(teamStatus);
            localStorage.setItem('teamStatuses', JSON.stringify(teamStatuses));
            
            showAlert('team-status-alert', 'íŒ€ë³„ ì—…ë¬´í˜„í™©ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            resetTeamStatusForm();
            loadTeamStatuses();
        });

        // ê³µì§€ì‚¬í•­ ëª©ë¡ ë¡œë“œ
        function loadNotices() {
            const tbody = document.getElementById('notices-table').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            
            // ìµœì‹ ìˆœ ì •ë ¬
            const sortedNotices = [...notices].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedNotices.forEach((notice, index) => {
                const row = tbody.insertRow();
                const completedClass = notice.completed ? 'completed-item' : '';
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td class="checkbox-cell">
                        <input type="checkbox" ${notice.completed ? 'checked' : ''} 
                               onchange="toggleNoticeComplete(${notice.id})">
                    </td>
                    <td class="${completedClass}">${notice.title}</td>
                    <td class="${completedClass}" style="max-width: 300px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${notice.content}</td>
                    <td class="${completedClass}">${notice.date}</td>
                    <td class="${completedClass}">${notice.deadline || '-'}</td>
                    <td class="action-btns">
                        <button class="action-btn btn-danger" onclick="deleteNotice(${notice.id})">ì‚­ì œ</button>
                    </td>
                `;
            });
            
            if (notices.length === 0) {
                const row = tbody.insertRow();
                row.innerHTML = '<td colspan="7" style="text-align: center; padding: 30px;">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</td>';
            }
        }

        // ê³µì§€ì‚¬í•­ ì™„ë£Œ í† ê¸€
        function toggleNoticeComplete(id) {
            const notice = notices.find(n => n.id === id);
            if (notice) {
                notice.completed = !notice.completed;
                localStorage.setItem('notices', JSON.stringify(notices));
                loadNotices();
            }
        }

        // íŒ€ë³„ ì—…ë¬´í˜„í™© ëª©ë¡ ë¡œë“œ
        function loadTeamStatuses() {
            const tbody = document.getElementById('team-status-table').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            
            // ìµœì‹ ìˆœ ì •ë ¬
            const sortedStatuses = [...teamStatuses].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedStatuses.forEach((status, index) => {
                const row = tbody.insertRow();
                const completedClass = status.completed ? 'completed-item' : '';
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td class="checkbox-cell">
                        <input type="checkbox" ${status.completed ? 'checked' : ''} 
                               onchange="toggleTeamStatusComplete(${status.id})">
                    </td>
                    <td class="${completedClass}">${status.teamName}</td>
                    <td class="${completedClass}" style="max-width: 300px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${status.content}</td>
                    <td class="${completedClass}">${status.date}</td>
                    <td class="${completedClass}">${status.deadline || '-'}</td>
                    <td class="action-btns">
                        <button class="action-btn btn-danger" onclick="deleteTeamStatus(${status.id})">ì‚­ì œ</button>
                    </td>
                `;
            });
            
            if (teamStatuses.length === 0) {
                const row = tbody.insertRow();
                row.innerHTML = '<td colspan="7" style="text-align: center; padding: 30px;">ë“±ë¡ëœ ì—…ë¬´í˜„í™©ì´ ì—†ìŠµë‹ˆë‹¤.</td>';
            }
        }

        // íŒ€ë³„ ì—…ë¬´í˜„í™© ì™„ë£Œ í† ê¸€
        function toggleTeamStatusComplete(id) {
            const status = teamStatuses.find(t => t.id === id);
            if (status) {
                status.completed = !status.completed;
                localStorage.setItem('teamStatuses', JSON.stringify(teamStatuses));
                loadTeamStatuses();
            }
        }

        // ëŒ€ì‹œë³´ë“œì— ê³µì§€ì‚¬í•­ í‘œì‹œ (ìµœê·¼ 5ê°œ)
        function loadDashboardNotices() {
            const noticeList = document.getElementById('notice-list');
            const sortedNotices = [...notices].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);
            
            if (sortedNotices.length === 0) {
                noticeList.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
                noticeList.innerHTML = sortedNotices.map(notice => {
                    const completedStyle = notice.completed ? 'text-decoration: line-through; text-decoration-color: #ff0000; opacity: 0.7;' : '';
                    const deadlineText = notice.deadline ? `<div style="font-size: 11px; opacity: 0.7;">ê¸°í•œ: ${notice.deadline}</div>` : '';
                    
                    return `
                    <div style="background: rgba(255,255,255,0.2); padding: 10px; margin-bottom: 8px; border-radius: 5px; border-left: 3px solid white;">
                        <div style="font-weight: bold; margin-bottom: 5px; ${completedStyle}">${notice.completed ? 'âœ… ' : ''}${notice.title}</div>
                        <div style="font-size: 12px; opacity: 0.9; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; ${completedStyle}">${notice.content}</div>
                        <div style="font-size: 11px; opacity: 0.7;">ì‘ì„±: ${notice.date}</div>
                        ${deadlineText}
                    </div>
                `;
                }).join('');
            }
        }

        // ëŒ€ì‹œë³´ë“œì— íŒ€ë³„ ì—…ë¬´í˜„í™© í‘œì‹œ (ìµœê·¼ 5ê°œ)
        function loadDashboardTeamStatuses() {
            const teamStatusList = document.getElementById('team-status-list');
            const sortedStatuses = [...teamStatuses].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);
            
            if (sortedStatuses.length === 0) {
                teamStatusList.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">ë“±ë¡ëœ ì—…ë¬´í˜„í™©ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
                teamStatusList.innerHTML = sortedStatuses.map(status => {
                    const completedStyle = status.completed ? 'text-decoration: line-through; text-decoration-color: #ff0000; opacity: 0.7;' : '';
                    const deadlineText = status.deadline ? `<div style="font-size: 11px; opacity: 0.7;">ê¸°í•œ: ${status.deadline}</div>` : '';
                    
                    return `
                    <div style="background: rgba(255,255,255,0.2); padding: 10px; margin-bottom: 8px; border-radius: 5px; border-left: 3px solid white;">
                        <div style="font-weight: bold; margin-bottom: 5px; ${completedStyle}">${status.completed ? 'âœ… ' : ''}${status.teamName}</div>
                        <div style="font-size: 12px; opacity: 0.9; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; ${completedStyle}">${status.content}</div>
                        <div style="font-size: 11px; opacity: 0.7;">ì‘ì„±: ${status.date}</div>
                        ${deadlineText}
                    </div>
                `;
                }).join('');
            }
        }

        // ê³µì§€ì‚¬í•­ ì‚­ì œ
        function deleteNotice(id) {
            if (!confirm('ì´ ê³µì§€ì‚¬í•­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            notices = notices.filter(n => n.id !== id);
            localStorage.setItem('notices', JSON.stringify(notices));
            
            showAlert('notices-alert', 'ê³µì§€ì‚¬í•­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            loadAllData();
        }

        // íŒ€ë³„ ì—…ë¬´í˜„í™© ì‚­ì œ
        function deleteTeamStatus(id) {
            if (!confirm('ì´ ì—…ë¬´í˜„í™©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            teamStatuses = teamStatuses.filter(t => t.id !== id);
            localStorage.setItem('teamStatuses', JSON.stringify(teamStatuses));
            
            showAlert('team-status-alert', 'ì—…ë¬´í˜„í™©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            loadAllData();
        }

        // í¼ ì´ˆê¸°í™”
        function resetNoticeForm() {
            document.getElementById('notice-form').reset();
            setTodayDate();
        }

        function resetTeamStatusForm() {
            document.getElementById('team-status-form').reset();
            setTodayDate();
        }

        // ê²€ìƒ‰ ê¸°ëŠ¥
        function searchNotices() {
            const searchText = document.getElementById('notice-search').value.toLowerCase();
            const rows = document.getElementById('notices-table').getElementsByTagName('tbody')[0].rows;
            
            Array.from(rows).forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchText) ? '' : 'none';
            });
        }

        function searchTeamStatus() {
            const searchText = document.getElementById('team-status-search').value.toLowerCase();
            const rows = document.getElementById('team-status-table').getElementsByTagName('tbody')[0].rows;
            
            Array.from(rows).forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchText) ? '' : 'none';
            });
        }

        // ì—‘ì…€ ì—…ë¡œë“œ
        function uploadExcel() {
            const fileInput = document.getElementById('excel-upload');
            const file = fileInput.files[0];
            
            if (!file) {
                showAlert('materials-alert', 'íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                    
                    // ì²« ë²ˆì§¸ í–‰ì€ í—¤ë”ë¡œ ê°„ì£¼í•˜ê³  ì œì™¸
                    const rows = jsonData.slice(1);
                    
                    uploadedMaterials = [];
                    let successCount = 0;
                    let duplicateCount = 0;
                    
                    rows.forEach(row => {
                        if (row.length >= 4 && row[0] && row[1] && row[2] && row[3]) {
                            const materialData = {
                                name: String(row[0]).trim(),
                                spec: String(row[1]).trim(),
                                unit: String(row[2]).trim(),
                                contractQty: parseFloat(row[3]) || 0,
                                note: row[4] ? String(row[4]).trim() : ''
                            };
                            
                            // ì¤‘ë³µ ì²´í¬ (í’ˆëª… + ê·œê²©ì´ ê°™ìœ¼ë©´ ì¤‘ë³µ)
                            const isDuplicate = materials.some(m => 
                                m.name === materialData.name && m.spec === materialData.spec
                            );
                            
                            if (!isDuplicate) {
                                // ìì¬ ë“±ë¡
                                const newMaterial = {
                                    id: Date.now() + successCount, // ê³ ìœ  ID ìƒì„±
                                    name: materialData.name,
                                    spec: materialData.spec,
                                    unit: materialData.unit,
                                    contractQty: materialData.contractQty,
                                    note: materialData.note
                                };
                                
                                materials.push(newMaterial);
                                uploadedMaterials.push(materialData);
                                successCount++;
                            } else {
                                duplicateCount++;
                            }
                        }
                    });
                    
                    if (successCount > 0) {
                        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                        localStorage.setItem('materials', JSON.stringify(materials));
                        localStorage.setItem('uploadedMaterials', JSON.stringify(uploadedMaterials));
                        
                        // í™”ë©´ ì—…ë°ì´íŠ¸
                        updateMaterialDatalist();
                        loadAllData();
                        
                        let message = `${successCount}ê°œì˜ ìì¬ê°€ ìë™ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`;
                        if (duplicateCount > 0) {
                            message += ` (ì¤‘ë³µ ${duplicateCount}ê°œ ì œì™¸)`;
                        }
                        showAlert('materials-alert', message, 'success');
                    } else if (duplicateCount > 0) {
                        showAlert('materials-alert', `ëª¨ë“  ìì¬ê°€ ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤. (ì¤‘ë³µ ${duplicateCount}ê°œ)`, 'warning');
                    } else {
                        showAlert('materials-alert', 'ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì—‘ì…€ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
                    }
                    
                    // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
                    fileInput.value = '';
                    
                } catch (error) {
                    showAlert('materials-alert', 'íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: ' + error.message, 'error');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        // ìì¬ ë°ì´í„°ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        function updateMaterialDatalist() {
            const nameSelect = document.getElementById('mat-name');
            const specSelect = document.getElementById('mat-spec');
            const unitDatalist = document.getElementById('material-unit-list');
            
            // ê¸°ì¡´ ì˜µì…˜ ì´ˆê¸°í™” (ì²« ë²ˆì§¸ ì˜µì…˜ì€ ìœ ì§€)
            nameSelect.innerHTML = '<option value="">í’ˆëª…ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            specSelect.innerHTML = '<option value="">ê·œê²©ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            unitDatalist.innerHTML = '';
            
            // ê³ ìœ ê°’ë§Œ ì¶”ì¶œ
            const uniqueNames = [...new Set(uploadedMaterials.map(m => m.name))];
            const uniqueSpecs = [...new Set(uploadedMaterials.map(m => m.spec))];
            const uniqueUnits = [...new Set(uploadedMaterials.map(m => m.unit))];
            
            // í’ˆëª… ì˜µì…˜ ì¶”ê°€
            uniqueNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                nameSelect.appendChild(option);
            });
            
            // ê·œê²© ì˜µì…˜ ì¶”ê°€
            uniqueSpecs.forEach(spec => {
                const option = document.createElement('option');
                option.value = spec;
                option.textContent = spec;
                specSelect.appendChild(option);
            });
            
            // ë‹¨ìœ„ datalist ì¶”ê°€
            uniqueUnits.forEach(unit => {
                const option = document.createElement('option');
                option.value = unit;
                unitDatalist.appendChild(option);
            });
        }

        // í’ˆëª… ì„ íƒ ì‹œ ê·œê²© í•„í„°ë§ ë° ìë™ ì™„ì„±
        function onMaterialNameChange() {
            const selectedName = document.getElementById('mat-name').value;
            const specSelect = document.getElementById('mat-spec');
            
            // ê·œê²© ì´ˆê¸°í™”
            specSelect.innerHTML = '<option value="">ê·œê²©ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            
            if (!selectedName) {
                // í’ˆëª…ì´ ì„ íƒë˜ì§€ ì•Šìœ¼ë©´ ëª¨ë“  ê·œê²© í‘œì‹œ
                const uniqueSpecs = [...new Set(uploadedMaterials.map(m => m.spec))];
                uniqueSpecs.forEach(spec => {
                    const option = document.createElement('option');
                    option.value = spec;
                    option.textContent = spec;
                    specSelect.appendChild(option);
                });
                return;
            }
            
            // ì„ íƒëœ í’ˆëª…ì— í•´ë‹¹í•˜ëŠ” ê·œê²©ë§Œ í•„í„°ë§
            const filteredMaterials = uploadedMaterials.filter(m => m.name === selectedName);
            const filteredSpecs = [...new Set(filteredMaterials.map(m => m.spec))];
            
            filteredSpecs.forEach(spec => {
                const option = document.createElement('option');
                option.value = spec;
                option.textContent = spec;
                specSelect.appendChild(option);
            });
            
            // í•´ë‹¹ í’ˆëª…ì˜ ê·œê²©ì´ í•˜ë‚˜ë§Œ ìˆìœ¼ë©´ ìë™ ì„ íƒí•˜ê³  ë°ì´í„° ì±„ìš°ê¸°
            if (filteredSpecs.length === 1) {
                specSelect.value = filteredSpecs[0];
                fillMaterialData(selectedName, filteredSpecs[0]);
            }
        }

        // ê·œê²© ì„ íƒ ì‹œ ìë™ ì™„ì„±
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('mat-spec').addEventListener('change', function() {
                const selectedName = document.getElementById('mat-name').value;
                const selectedSpec = this.value;
                
                if (selectedName && selectedSpec) {
                    fillMaterialData(selectedName, selectedSpec);
                }
            });
        });

        // ìì¬ ë°ì´í„° ìë™ ì±„ìš°ê¸°
        function fillMaterialData(name, spec) {
            const matchedMaterial = uploadedMaterials.find(m => m.name === name && m.spec === spec);
            
            if (matchedMaterial) {
                document.getElementById('mat-unit').value = matchedMaterial.unit;
                document.getElementById('mat-quantity').value = matchedMaterial.contractQty;
                document.getElementById('mat-note').value = matchedMaterial.note;
            }
        }

        // ê¸°ì¡´ í’ˆëª… ìë™ì™„ì„± ì½”ë“œ ì œê±° (ì´ë¯¸ ìœ„ì—ì„œ ì²˜ë¦¬)
        /* document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('mat-name').addEventListener('input', function() {
                const selectedName = this.value;
                const matchedMaterial = uploadedMaterials.find(m => m.name === selectedName);
                
                if (matchedMaterial) {
                    document.getElementById('mat-spec').value = matchedMaterial.spec;
                    document.getElementById('mat-unit').value = matchedMaterial.unit;
                    document.getElementById('mat-quantity').value = matchedMaterial.contractQty;
                    document.getElementById('mat-note').value = matchedMaterial.note;
                }
            });
        }); */

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            // í´ë¦­ëœ íƒ­ ì°¾ê¸°
            const clickedTab = Array.from(tabs).find(tab => 
                tab.getAttribute('onclick') && tab.getAttribute('onclick').includes(tabName)
            );
            if (clickedTab) clickedTab.classList.add('active');
            
            document.getElementById(tabName).classList.add('active');
            
            // íŠ¹ì • íƒ­ë§Œ ë¡œë“œ (ë²„í¼ë§ ê°œì„ )
            switch(tabName) {
                case 'dashboard':
                    loadDashboardNotices();
                    loadDashboardTeamStatuses();
                    updateDashboard();
                    break;
                case 'notices':
                    loadNotices();
                    break;
                case 'team-status':
                    loadTeamStatuses();
                    break;
                case 'materials':
                    loadMaterials();
                    break;
                case 'incoming':
                    loadIncoming();
                    updateMaterialSelects();
                    break;
                case 'outgoing':
                    loadOutgoing();
                    updateOutgoingMaterialSelects();
                    break;
                case 'history':
                    loadHistory();
                    break;
            }
        }

        // ëª¨ë“  ë°ì´í„° ë¡œë“œ
        function loadAllData() {
            loadMaterials();
            loadIncoming();
            loadOutgoing();
            loadHistory();
            loadNotices();
            loadTeamStatuses();
            loadDashboardNotices();
            loadDashboardTeamStatuses();
            updateDashboard();
            updateMaterialSelects();
        }

        // ìì¬ ë“±ë¡
        document.getElementById('material-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const material = {
                id: Date.now(),
                name: document.getElementById('mat-name').value,
                spec: document.getElementById('mat-spec').value,
                unit: document.getElementById('mat-unit').value,
                contractQty: parseFloat(document.getElementById('mat-quantity').value),
                note: document.getElementById('mat-note').value
            };
            
            materials.push(material);
            localStorage.setItem('materials', JSON.stringify(materials));
            
            showAlert('materials-alert', 'ìì¬ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            resetMaterialForm();
            loadMaterials();
            updateMaterialSelects();
            updateOutgoingMaterialSelects();
        });

        // ì…ê³  ë“±ë¡
        document.getElementById('incoming-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const materialName = document.getElementById('in-material-name').value;
            const materialSpec = document.getElementById('in-material-spec').value;
            const material = materials.find(m => m.name === materialName && m.spec === materialSpec);
            
            if (!material) {
                showAlert('incoming-alert', 'ì„ íƒí•œ ìì¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            const record = {
                id: Date.now(),
                materialId: material.id,
                date: document.getElementById('in-date').value,
                quantity: parseFloat(document.getElementById('in-quantity').value),
                note: document.getElementById('in-note').value
            };
            
            incoming.push(record);
            localStorage.setItem('incoming', JSON.stringify(incoming));
            
            showAlert('incoming-alert', 'ì…ê³ ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            resetIncomingForm();
            loadIncoming();
            updateOutgoingMaterialSelects(); // ì¶œê³  ìì¬ ëª©ë¡ë„ ì—…ë°ì´íŠ¸
        });

        // ì‚¬ìš©(ì¶œê³ ) ë“±ë¡
        document.getElementById('outgoing-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const materialName = document.getElementById('out-material-name').value;
            const materialSpec = document.getElementById('out-material-spec').value;
            const material = materials.find(m => m.name === materialName && m.spec === materialSpec);
            
            if (!material) {
                showAlert('outgoing-alert', 'ì„ íƒí•œ ìì¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            const quantity = parseFloat(document.getElementById('out-quantity').value);
            
            // ì¬ê³  í™•ì¸
            const available = getAvailableQuantity(material.id);
            if (quantity > available) {
                showAlert('outgoing-alert', `ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. í˜„ì¬ ì”ì—¬ ìˆ˜ëŸ‰: ${available}`, 'error');
                return;
            }
            
            const record = {
                id: Date.now(),
                materialId: material.id,
                date: document.getElementById('out-date').value,
                quantity: quantity,
                note: document.getElementById('out-note').value
            };
            
            outgoing.push(record);
            localStorage.setItem('outgoing', JSON.stringify(outgoing));
            
            showAlert('outgoing-alert', 'ì‚¬ìš©(ì¶œê³ )ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            resetOutgoingForm();
            loadOutgoing();
        });

        // ìì¬ ëª©ë¡ ë¡œë“œ
        function loadMaterials() {
            const tbody = document.getElementById('materials-table').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            
            materials.forEach((material, index) => {
                const incomingQty = getIncomingQuantity(material.id);
                const outgoingQty = getOutgoingQuantity(material.id);
                const remaining = incomingQty - outgoingQty;
                
                const row = tbody.insertRow();
                const isLowStock = remaining < material.contractQty * 0.2;
                if (isLowStock) row.classList.add('low-stock');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${material.name}</td>
                    <td>${material.spec}</td>
                    <td>${material.unit}</td>
                    <td>${material.contractQty.toLocaleString()}</td>
                    <td>${incomingQty.toLocaleString()}</td>
                    <td>${outgoingQty.toLocaleString()}</td>
                    <td>${remaining.toLocaleString()}</td>
                    <td>${material.note}</td>
                    <td class="action-btns">
                        <button class="action-btn btn-warning" onclick="editMaterial(${material.id})">ìˆ˜ì •</button>
                        <button class="action-btn btn-danger" onclick="deleteMaterial(${material.id})">ì‚­ì œ</button>
                    </td>
                `;
            });
        }

        // ì…ê³  ë‚´ì—­ ë¡œë“œ
        function loadIncoming() {
            const tbody = document.getElementById('incoming-table').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            
            incoming.forEach((record, index) => {
                const material = materials.find(m => m.id === record.materialId);
                if (!material) return;
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${material.name}</td>
                    <td>${material.spec}</td>
                    <td>${material.unit}</td>
                    <td>${record.date}</td>
                    <td>${record.quantity.toLocaleString()}</td>
                    <td>${record.note}</td>
                    <td class="action-btns">
                        <button class="action-btn btn-danger" onclick="deleteIncoming(${record.id})">ì‚­ì œ</button>
                    </td>
                `;
            });
        }

        // ì‚¬ìš©(ì¶œê³ ) ë‚´ì—­ ë¡œë“œ
        function loadOutgoing() {
            const tbody = document.getElementById('outgoing-table').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            
            outgoing.forEach((record, index) => {
                const material = materials.find(m => m.id === record.materialId);
                if (!material) return;
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${material.name}</td>
                    <td>${material.spec}</td>
                    <td>${material.unit}</td>
                    <td>${record.date}</td>
                    <td>${record.quantity.toLocaleString()}</td>
                    <td>${record.note}</td>
                    <td class="action-btns">
                        <button class="action-btn btn-danger" onclick="deleteOutgoing(${record.id})">ì‚­ì œ</button>
                    </td>
                `;
            });
        }

        // ì „ì²´ ë‚´ì—­ ë¡œë“œ
        function loadHistory() {
            const tbody = document.getElementById('history-table').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            
            materials.forEach((material, index) => {
                const incomingRecords = incoming.filter(i => i.materialId === material.id);
                const outgoingRecords = outgoing.filter(o => o.materialId === material.id);
                
                const incomingQty = getIncomingQuantity(material.id);
                const outgoingQty = getOutgoingQuantity(material.id);
                const remaining = incomingQty - outgoingQty;
                
                // ì…ê³ /ì¶œê³  ë‚´ì—­ì´ ìˆëŠ” ê²½ìš°
                const maxRecords = Math.max(incomingRecords.length, outgoingRecords.length, 1);
                
                for (let i = 0; i < maxRecords; i++) {
                    const inRecord = incomingRecords[i];
                    const outRecord = outgoingRecords[i];
                    
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${i === 0 ? index + 1 : ''}</td>
                        <td>${i === 0 ? material.name : ''}</td>
                        <td>${i === 0 ? material.spec : ''}</td>
                        <td>${i === 0 ? material.unit : ''}</td>
                        <td>${i === 0 ? material.contractQty.toLocaleString() : ''}</td>
                        <td>${inRecord ? inRecord.date : ''}</td>
                        <td>${inRecord ? inRecord.quantity.toLocaleString() : ''}</td>
                        <td>${outRecord ? outRecord.date : ''}</td>
                        <td>${outRecord ? outRecord.quantity.toLocaleString() : ''}</td>
                        <td>${i === 0 ? remaining.toLocaleString() : ''}</td>
                        <td>${i === 0 ? material.note : ''}</td>
                    `;
                }
            });
        }

        // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
        function updateDashboard() {
            // ìì¬ í˜„í™© í…Œì´ë¸” - ì…ì¶œê³  ë‚´ì—­ì´ ìˆëŠ” ìì¬ë§Œ í‘œì‹œ
            const tbody = document.getElementById('low-stock-table').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            
            // ì…ì¶œê³  ë‚´ì—­ì´ ìˆëŠ” ìì¬ë§Œ í•„í„°ë§
            const materialsWithHistory = materials.filter(material => {
                const incomingQty = getIncomingQuantity(material.id);
                const outgoingQty = getOutgoingQuantity(material.id);
                return incomingQty > 0 || outgoingQty > 0;
            });
            
            materialsWithHistory.forEach((material, index) => {
                const incomingQty = getIncomingQuantity(material.id);
                const outgoingQty = getOutgoingQuantity(material.id);
                const remaining = incomingQty - outgoingQty;
                const percentage = incomingQty > 0 ? ((incomingQty - remaining) / incomingQty * 100).toFixed(1) : 0;
                
                const row = tbody.insertRow();
                // ì¬ê³  ë¶€ì¡± ì‹œ í•˜ì´ë¼ì´íŠ¸ (ì…ê³ ìˆ˜ëŸ‰ ëŒ€ë¹„ ì”ì—¬ìˆ˜ëŸ‰ì´ 20% ë¯¸ë§Œ)
                if (incomingQty > 0 && remaining < incomingQty * 0.2) {
                    row.classList.add('low-stock');
                }
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${material.name}</td>
                    <td>${material.spec}</td>
                    <td>${material.unit}</td>
                    <td>${material.contractQty.toLocaleString()}</td>
                    <td>${incomingQty.toLocaleString()}</td>
                    <td>${outgoingQty.toLocaleString()}</td>
                    <td>${remaining.toLocaleString()}</td>
                    <td>${percentage}%</td>
                    <td>${material.note}</td>
                `;
            });
            
            if (materialsWithHistory.length === 0) {
                const row = tbody.insertRow();
                row.innerHTML = '<td colspan="10" style="text-align: center; padding: 30px;">ì…ì¶œê³  ë‚´ì—­ì´ ìˆëŠ” ìì¬ê°€ ì—†ìŠµë‹ˆë‹¤.</td>';
            }
        }

        // ìì¬ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ (ì…ê³  ê´€ë¦¬ìš©)
        function updateMaterialSelects() {
            const inNameSelect = document.getElementById('in-material-name');
            const inSpecSelect = document.getElementById('in-material-spec');
            
            // ì´ˆê¸°í™”
            inNameSelect.innerHTML = '<option value="">í’ˆëª…ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            inSpecSelect.innerHTML = '<option value="">ê·œê²©ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            
            // ê³ ìœ  í’ˆëª… ì¶”ì¶œ
            const uniqueNames = [...new Set(materials.map(m => m.name))];
            
            uniqueNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                inNameSelect.appendChild(option);
            });
        }

        // ìì¬ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ (ì¶œê³  ê´€ë¦¬ìš© - ì…ê³ ëœ ìì¬ë§Œ)
        function updateOutgoingMaterialSelects() {
            const outNameSelect = document.getElementById('out-material-name');
            const outSpecSelect = document.getElementById('out-material-spec');
            
            // ì´ˆê¸°í™”
            outNameSelect.innerHTML = '<option value="">í’ˆëª…ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            outSpecSelect.innerHTML = '<option value="">ê·œê²©ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            
            // ì…ê³  ìˆ˜ëŸ‰ì´ ìˆëŠ” ìì¬ë§Œ í•„í„°ë§
            const materialsWithIncoming = materials.filter(m => {
                const incomingQty = getIncomingQuantity(m.id);
                return incomingQty > 0;
            });
            
            // ê³ ìœ  í’ˆëª… ì¶”ì¶œ
            const uniqueNames = [...new Set(materialsWithIncoming.map(m => m.name))];
            
            uniqueNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                outNameSelect.appendChild(option);
            });
        }

        // ì…ê³  - í’ˆëª… ì„ íƒ ì‹œ ê·œê²© í•„í„°ë§
        function onIncomingNameChange() {
            const selectedName = document.getElementById('in-material-name').value;
            const specSelect = document.getElementById('in-material-spec');
            
            specSelect.innerHTML = '<option value="">ê·œê²©ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            
            if (!selectedName) return;
            
            const filteredMaterials = materials.filter(m => m.name === selectedName);
            const filteredSpecs = [...new Set(filteredMaterials.map(m => m.spec))];
            
            filteredSpecs.forEach(spec => {
                const option = document.createElement('option');
                option.value = spec;
                option.textContent = spec;
                specSelect.appendChild(option);
            });
            
            if (filteredSpecs.length === 1) {
                specSelect.value = filteredSpecs[0];
            }
        }

        // ì…ê³  - ê·œê²© ì„ íƒ ì™„ë£Œ
        function onIncomingSpecChange() {
            // í•„ìš” ì‹œ ì¶”ê°€ ë™ì‘ êµ¬í˜„
        }

        // ì¶œê³  - í’ˆëª… ì„ íƒ ì‹œ ê·œê²© í•„í„°ë§ (ì…ê³ ëœ ìì¬ë§Œ)
        function onOutgoingNameChange() {
            const selectedName = document.getElementById('out-material-name').value;
            const specSelect = document.getElementById('out-material-spec');
            
            specSelect.innerHTML = '<option value="">ê·œê²©ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            
            if (!selectedName) return;
            
            // ì…ê³  ìˆ˜ëŸ‰ì´ ìˆëŠ” ìì¬ë§Œ í•„í„°ë§
            const materialsWithIncoming = materials.filter(m => {
                const incomingQty = getIncomingQuantity(m.id);
                return m.name === selectedName && incomingQty > 0;
            });
            
            const filteredSpecs = [...new Set(materialsWithIncoming.map(m => m.spec))];
            
            filteredSpecs.forEach(spec => {
                const option = document.createElement('option');
                option.value = spec;
                option.textContent = spec;
                specSelect.appendChild(option);
            });
            
            if (filteredSpecs.length === 1) {
                specSelect.value = filteredSpecs[0];
            }
        }

        // ì¶œê³  - ê·œê²© ì„ íƒ ì™„ë£Œ
        function onOutgoingSpecChange() {
            // í•„ìš” ì‹œ ì¶”ê°€ ë™ì‘ êµ¬í˜„
        }

        // ì…ê³  ìˆ˜ëŸ‰ ê³„ì‚°
        function getIncomingQuantity(materialId) {
            return incoming
                .filter(i => i.materialId === materialId)
                .reduce((sum, i) => sum + i.quantity, 0);
        }

        // ì¶œê³  ìˆ˜ëŸ‰ ê³„ì‚°
        function getOutgoingQuantity(materialId) {
            return outgoing
                .filter(o => o.materialId === materialId)
                .reduce((sum, o) => sum + o.quantity, 0);
        }

        // ì”ì—¬ ìˆ˜ëŸ‰ ê³„ì‚°
        function getAvailableQuantity(materialId) {
            return getIncomingQuantity(materialId) - getOutgoingQuantity(materialId);
        }

        // ìì¬ ì‚­ì œ
        function deleteMaterial(id) {
            if (!confirm('ì´ ìì¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nê´€ë ¨ëœ ëª¨ë“  ì…ì¶œê³  ë‚´ì—­ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.')) return;
            
            materials = materials.filter(m => m.id !== id);
            incoming = incoming.filter(i => i.materialId !== id);
            outgoing = outgoing.filter(o => o.materialId !== id);
            
            localStorage.setItem('materials', JSON.stringify(materials));
            localStorage.setItem('incoming', JSON.stringify(incoming));
            localStorage.setItem('outgoing', JSON.stringify(outgoing));
            
            showAlert('materials-alert', 'ìì¬ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            loadAllData();
        }

        // ì…ê³  ì‚­ì œ
        function deleteIncoming(id) {
            if (!confirm('ì´ ì…ê³  ë‚´ì—­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            incoming = incoming.filter(i => i.id !== id);
            localStorage.setItem('incoming', JSON.stringify(incoming));
            
            showAlert('incoming-alert', 'ì…ê³  ë‚´ì—­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            loadAllData();
        }

        // ì¶œê³  ì‚­ì œ
        function deleteOutgoing(id) {
            if (!confirm('ì´ ì‚¬ìš©(ì¶œê³ ) ë‚´ì—­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            outgoing = outgoing.filter(o => o.id !== id);
            localStorage.setItem('outgoing', JSON.stringify(outgoing));
            
            showAlert('outgoing-alert', 'ì‚¬ìš©(ì¶œê³ ) ë‚´ì—­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            loadAllData();
        }

        // í¼ ì´ˆê¸°í™”
        function resetMaterialForm() {
            document.getElementById('material-form').reset();
            // select ë°•ìŠ¤ë¥¼ ì´ˆê¸° ìƒíƒœë¡œ
            document.getElementById('mat-name').value = '';
            document.getElementById('mat-spec').value = '';
            // ê·œê²© ì˜µì…˜ ë‹¤ì‹œ ë¡œë“œ
            updateMaterialDatalist();
        }

        function resetIncomingForm() {
            document.getElementById('incoming-form').reset();
            document.getElementById('in-material-name').value = '';
            document.getElementById('in-material-spec').value = '';
            setTodayDate();
            updateMaterialSelects();
        }

        function resetOutgoingForm() {
            document.getElementById('outgoing-form').reset();
            document.getElementById('out-material-name').value = '';
            document.getElementById('out-material-spec').value = '';
            setTodayDate();
            updateOutgoingMaterialSelects();
        }

        // ê²€ìƒ‰ ê¸°ëŠ¥
        function searchMaterials() {
            const searchText = document.getElementById('material-search').value.toLowerCase();
            const rows = document.getElementById('materials-table').getElementsByTagName('tbody')[0].rows;
            
            Array.from(rows).forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchText) ? '' : 'none';
            });
        }

        function searchIncoming() {
            const searchText = document.getElementById('incoming-search').value.toLowerCase();
            const rows = document.getElementById('incoming-table').getElementsByTagName('tbody')[0].rows;
            
            Array.from(rows).forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchText) ? '' : 'none';
            });
        }

        function searchOutgoing() {
            const searchText = document.getElementById('outgoing-search').value.toLowerCase();
            const rows = document.getElementById('outgoing-table').getElementsByTagName('tbody')[0].rows;
            
            Array.from(rows).forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchText) ? '' : 'none';
            });
        }

        function searchHistory() {
            const searchText = document.getElementById('history-search').value.toLowerCase();
            const rows = document.getElementById('history-table').getElementsByTagName('tbody')[0].rows;
            
            Array.from(rows).forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchText) ? '' : 'none';
            });
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showAlert(elementId, message, type) {
            const alert = document.getElementById(elementId);
            alert.textContent = message;
            alert.className = `alert ${type}`;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 3000);
        }

        // Excel ë‹¤ìš´ë¡œë“œ
        function exportToExcel(type) {
            let csvContent = '';
            let filename = '';
            
            switch(type) {
                case 'materials':
                    csvContent = 'ë²ˆí˜¸,í’ˆëª…,ê·œê²©,ë‹¨ìœ„,ê³„ì•½ìˆ˜ëŸ‰,ì…ê³ ìˆ˜ëŸ‰,ì‚¬ìš©ìˆ˜ëŸ‰,ì”ì—¬ìˆ˜ëŸ‰,ë¹„ê³ \n';
                    materials.forEach((material, index) => {
                        const incomingQty = getIncomingQuantity(material.id);
                        const outgoingQty = getOutgoingQuantity(material.id);
                        const remaining = incomingQty - outgoingQty;
                        csvContent += `${index + 1},${material.name},${material.spec},${material.unit},${material.contractQty},${incomingQty},${outgoingQty},${remaining},${material.note}\n`;
                    });
                    filename = 'ìì¬ëª©ë¡.csv';
                    break;
                    
                case 'incoming':
                    csvContent = 'ë²ˆí˜¸,í’ˆëª…,ê·œê²©,ë‹¨ìœ„,ì…ê³ ì¼,ì…ê³ ìˆ˜ëŸ‰,ë¹„ê³ \n';
                    incoming.forEach((record, index) => {
                        const material = materials.find(m => m.id === record.materialId);
                        if (material) {
                            csvContent += `${index + 1},${material.name},${material.spec},${material.unit},${record.date},${record.quantity},${record.note}\n`;
                        }
                    });
                    filename = 'ì…ê³ ë‚´ì—­.csv';
                    break;
                    
                case 'outgoing':
                    csvContent = 'ë²ˆí˜¸,í’ˆëª…,ê·œê²©,ë‹¨ìœ„,ì‚¬ìš©ì¼,ì‚¬ìš©ìˆ˜ëŸ‰,ë¹„ê³ \n';
                    outgoing.forEach((record, index) => {
                        const material = materials.find(m => m.id === record.materialId);
                        if (material) {
                            csvContent += `${index + 1},${material.name},${material.spec},${material.unit},${record.date},${record.quantity},${record.note}\n`;
                        }
                    });
                    filename = 'ì‚¬ìš©ë‚´ì—­.csv';
                    break;
                    
                case 'history':
                    csvContent = 'ë²ˆí˜¸,í’ˆëª…,ê·œê²©,ë‹¨ìœ„,ê³„ì•½ìˆ˜ëŸ‰,ì…ê³ ì¼,ì…ê³ ìˆ˜ëŸ‰,ì‚¬ìš©ì¼,ì‚¬ìš©ìˆ˜ëŸ‰,ì”ì—¬ìˆ˜ëŸ‰,ë¹„ê³ \n';
                    materials.forEach((material, index) => {
                        const incomingRecords = incoming.filter(i => i.materialId === material.id);
                        const outgoingRecords = outgoing.filter(o => o.materialId === material.id);
                        const remaining = getAvailableQuantity(material.id);
                        
                        const maxRecords = Math.max(incomingRecords.length, outgoingRecords.length, 1);
                        
                        for (let i = 0; i < maxRecords; i++) {
                            const inRecord = incomingRecords[i];
                            const outRecord = outgoingRecords[i];
                            
                            csvContent += `${i === 0 ? index + 1 : ''},`;
                            csvContent += `${i === 0 ? material.name : ''},`;
                            csvContent += `${i === 0 ? material.spec : ''},`;
                            csvContent += `${i === 0 ? material.unit : ''},`;
                            csvContent += `${i === 0 ? material.contractQty : ''},`;
                            csvContent += `${inRecord ? inRecord.date : ''},`;
                            csvContent += `${inRecord ? inRecord.quantity : ''},`;
                            csvContent += `${outRecord ? outRecord.date : ''},`;
                            csvContent += `${outRecord ? outRecord.quantity : ''},`;
                            csvContent += `${i === 0 ? remaining : ''},`;
                            csvContent += `${i === 0 ? material.note : ''}\n`;
                        }
                    });
                    filename = 'ì „ì²´ë‚´ì—­.csv';
                    break;
            }
            
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }
    </script>
</body>
</html>
